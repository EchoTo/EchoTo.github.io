<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>

    <meta name="author" content="ShanTianQi">





<title>MySQL基础 | ShanTianQi&#39;s Blog</title>



    <link rel="icon" href="../../../../favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="../../../../css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="../../../../js/script.js"></script>
    
    <script src="../../../../js/tocbot.min.js"></script>
    



    
    
        
    


<!-- hexo injector head_end start --><script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@7.1.2/dist/mermaid.esm.min.mjs">
    mermaid.initialize(
      startOnLoad: true,
    );
    </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            pagebody.classList.add('dark-theme');
            // mobile
            document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            // if (isDark) {
            //     pagebody.classList.add('dark-theme');
            //     // mobile
            //     document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            // } else {
            //     pagebody.classList.remove('dark-theme');
            //     // mobile
            //     document.getElementById("mobile-toggle-theme").innerText = "· Light"
            // }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <!-- <div class="navbar-header header-logo"><a href="/">ShanTianQi&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="../../../../archives">Posts</a>
                
                    <a class="menu-item" href="../../../../category">Categories</a>
                
                    <a class="menu-item" href="../../../../tag">Tags</a>
                
                    <a class="menu-item" href="../../../../about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div> -->
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <!-- <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">ShanTianQi&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="../../../../archives">Posts</a>
                
                    <a class="menu-item" href="../../../../category">Categories</a>
                
                    <a class="menu-item" href="../../../../tag">Tags</a>
                
                    <a class="menu-item" href="../../../../about">About</a>
                
            </div>
        </div> -->
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">MySQL基础</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">ShanTianQi</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">January 27, 2022&nbsp;&nbsp;15:23:12</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h2><hr>
<h2 id="第一章-初识MySQL"><a href="#第一章-初识MySQL" class="headerlink" title="第一章    初识MySQL"></a>第一章    初识MySQL</h2><hr>
<h3 id="1-1相关概念"><a href="#1-1相关概念" class="headerlink" title="1.1相关概念"></a>1.1相关概念</h3><p>保存数据的容器：<code>数组</code>、<code>集合</code>、<code>文件</code></p>
<p><strong>使用数据库的好处：</strong></p>
<ul>
<li>实现数据持久化</li>
<li>使用完整的管理系统统一管理，易于查询</li>
</ul>
<p><strong>1.DB</strong></p>
<p>数据库(database)：存储数据的”仓库”。它保存了一系列有组织的数据。</p>
<p><strong>2.DBMS</strong></p>
<p>数据库管理系统(Database Management System)。数据库是通过DBMS创建和操作的容器。</p>
<p>常见的DBMS：MySQL、Oracle、DB2、SqlServer等</p>
<p><strong>3.SQL</strong></p>
<p>结构化查询语言(Structure Query Language)：专门用来与数据库通信的语言。</p>
<p><img src="https://tonkyshan.cn/img/202203021318347.png" alt="20210821171708"></p>
<p>优点：</p>
<ul>
<li>不是某个特定数据库供应商专有的语言，几乎所有DBMS都支持SQL</li>
<li>简单易学</li>
<li>虽然简单，但实际上是一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作。</li>
</ul>
<hr>
<h3 id="1-2数据库存储数据的特点"><a href="#1-2数据库存储数据的特点" class="headerlink" title="1.2数据库存储数据的特点"></a>1.2数据库存储数据的特点</h3><p>1.将数据放到表中，表再放到库中</p>
<p><img src="https://tonkyshan.cn/img/202203021318258.png" alt="20210821182429"></p>
<p>2.一个数据库中可以有多个表，每个表都有一个名字，用来标识自己。表名具有唯一性。</p>
<p>3.表具有一些特性，这些特性定义了数据再表中如何存储，类似java中”类”的设计。</p>
<p>4.表由列组成，我们也称为字段。所有表都是由一个或多个列组成的，每一列类似java中的”属性”。</p>
<p>5.表中的数据是按行存储的，每一行类似于java中的”对象”。</p>
<hr>
<h2 id="第二章-初始MySQL"><a href="#第二章-初始MySQL" class="headerlink" title="第二章    初始MySQL"></a>第二章    初始MySQL</h2><hr>
<h3 id="2-1MySQL产品的介绍"><a href="#2-1MySQL产品的介绍" class="headerlink" title="2.1MySQL产品的介绍"></a>2.1MySQL产品的介绍</h3><p>MySQL数据库隶属于MySQLAB公司，总部位于瑞典，后被oracle收购。</p>
<p>创始人：Monty</p>
<p>优点：</p>
<ul>
<li>成本低：开放源代码，一般可以免费试用</li>
<li>性能高：执行很快</li>
<li>简单：很容易安装和使用</li>
</ul>
<hr>
<h3 id="2-2MySQL产品的安装"><a href="#2-2MySQL产品的安装" class="headerlink" title="2.2MySQL产品的安装"></a>2.2MySQL产品的安装</h3><p>DBMS分为两类：</p>
<ul>
<li>基于共享文件系统的DBMS(Access)微软的</li>
<li>基于客户机——服务器的DBMS，比如MySQL、Oracle、SqlServer</li>
</ul>
<hr>
<p>2.3MySQL服务的启动和停止</p>
<p>第一种方法：WIN+R   输入  services.msc，找到MySQL右键启动或停止服务</p>
<p>第二种方法：以管理员身份打开cmd </p>
<ul>
<li>启动  <code>net start mysql</code></li>
<li>关闭  <code>net stop mysql</code></li>
</ul>
<hr>
<h3 id="2-4MySQL服务的登录与退出"><a href="#2-4MySQL服务的登录与退出" class="headerlink" title="2.4MySQL服务的登录与退出"></a>2.4MySQL服务的登录与退出</h3><p>登录：在dos窗口中输入命令<code>mysql -h localhost -P 3306 -u root -p</code></p>
<p>本机简写：<code>mysql -u root -p密码</code></p>
<ul>
<li>最前面的mysql你可以理解成一个关键字或者理解成一个固定的命令，是固定写法，类似于java、jdk中的javac命令或java命令</li>
<li>-h表示host,即主机的ip地址</li>
<li>-P表示port，端口，mysql数据库的默认端口是3306，当然啦，你可以自己改端口号，我这里没改端口号(注意：这是大写的字母P)</li>
<li>-u表示user用户名</li>
<li>-p表示password密码(注意：这是小写的字母p)</li>
</ul>
<blockquote>
<p><strong>大写的P表示端口号，小写的p表示密码</strong></p>
</blockquote>
<p>退出：<strong>exit</strong></p>
<hr>
<h3 id="2-5MySQL的常见命令和语法规范"><a href="#2-5MySQL的常见命令和语法规范" class="headerlink" title="2.5MySQL的常见命令和语法规范"></a>2.5MySQL的常见命令和语法规范</h3><p><strong>常见命令：</strong></p>
<p>1.查看当前所有的数据库</p>
<p><code>show databases;</code></p>
<p>2.打开指定的库</p>
<p><code>use 库名;</code></p>
<p>3.查看当前库的所有表</p>
<p><code>show tables;</code></p>
<p>4.查看其他库的所有表</p>
<p><code>show tables from 库名;</code></p>
<p>5.创建表</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE table 表名<span class="token punctuation">&#123;</span>
     列名  列类型，
     列名  列类型，
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.查看表结构</p>
<p><code>desc 表名;</code></p>
<p>7.查看服务器的版本</p>
<p>方式一：登录到mysql服务端</p>
<p><code>select version();</code></p>
<p>方式二：没有登录到mysql服务端</p>
<p><code>mysql --version</code>或者<code>mysql --V</code></p>
<p><strong>语法规范</strong>：</p>
<p>1.不区分大小写。但建议关键字大写，表名、列名小写</p>
<p>2.每条命令最好用分号结尾</p>
<p>3.每条命令根据需要，可以进行缩进或换行</p>
<p>4.注释</p>
<p>​     单行注释：#注释文字</p>
<p>​     单行注释：– 注释文字</p>
<p>​      多行注释：&#x2F;* 注释文字 *&#x2F;</p>
<hr>
<h2 id="第三章-DQL语言"><a href="#第三章-DQL语言" class="headerlink" title="第三章    DQL语言"></a>第三章    DQL语言</h2><hr>
<p><strong>数据查询语言</strong></p>
<h3 id="3-1基础查询"><a href="#3-1基础查询" class="headerlink" title="3.1基础查询"></a>3.1基础查询</h3><p><strong>语法：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT     查询列表     
FROM      表名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>类似于：System.out.println(打印东西);</p>
<p><strong>特点：</strong></p>
<p>1.查询列表可以是：表中的字段、常量值、表达式、函数</p>
<p>2.查询的结果是一个虚拟的表格</p>
<p><strong>1.查询表中的单个字段</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT last_name 
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>2.查询表中的多个字段</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>job_id 
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>3.查询表中的所有字段</strong></p>
<p>第一种方式：哪里不会点哪里(双击)（<del>坏笑</del>）</p>
<p>第二种方式：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> <span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>tips：</p>
<ul>
<li>查询前：<strong>USE   库名;</strong>         #进入指定的数据库</li>
<li>当表名和关键字重复时，表名用着重号包裹，如<code>name</code></li>
</ul>
</blockquote>
<p><strong>4.查询常量值</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token number">100</span><span class="token punctuation">;</span>
SELECT <span class="token char">'john'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>tips：字符型和日期型的常量值必须用单引号引起来，数值型不需要。</p>
</blockquote>
<p><strong>5.查询表达式</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token number">100</span><span class="token operator">*</span><span class="token number">98</span><span class="token punctuation">;</span>
SELECT <span class="token number">100</span><span class="token operator">%</span><span class="token number">98</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>6.查询函数</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">VERSION</span><span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>7.起别名</strong></p>
<ul>
<li>便于理解</li>
<li>如果要查询的字段有重名的情况，使用别名可以区分开来</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">方式一：使用AS
SELECT <span class="token number">100</span><span class="token operator">*</span><span class="token number">98</span> AS 结果<span class="token punctuation">(</span>别名<span class="token punctuation">)</span><span class="token punctuation">;</span>
方式二：使用空格
SELECT last_name 姓<span class="token punctuation">,</span>first_name 名 <span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#案例：查询salary，显示结果为 out put
SELECT salary AS 'out put' <span class="token class-name">FROM</span> employess<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>8.去重</strong></p>
<p>关键字：<strong>DISTINCT</strong></p>
<p><strong>去掉重复的数据</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT DISTINCT department_id FROM employees;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>9.+号的作用</strong></p>
<p>Java中的+</p>
<ul>
<li>运算符：两个操作数都为数值型</li>
<li>连接符：只要有一个操作数为字符串</li>
</ul>
<p>MySQL中的+</p>
<ul>
<li>仅仅只有一个功能：运算符</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token number">100</span><span class="token operator">+</span><span class="token number">90</span><span class="token punctuation">;</span>#两个操作数都为数值型，则做加法运算
SELECT <span class="token char">'123'</span><span class="token operator">+</span><span class="token number">90</span><span class="token punctuation">;</span>#其中一方为字符型，则试图将字符型数值转换成数值型，如果转换成功，则继续做加法运算，
SELECT <span class="token char">'john'</span><span class="token operator">+</span><span class="token number">90</span><span class="token punctuation">;</span>
#如果转换失败，则将字符型数值转换成<span class="token number">0</span>
SELECT <span class="token keyword">null</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">;</span>#只要一方为<span class="token keyword">null</span>，结果肯定为<span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例：查询员工名和姓连接成一个字段，并显示 姓名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CONCAT</span><span class="token punctuation">(</span><span class="token char">'A'</span><span class="token punctuation">,</span><span class="token char">'B'</span><span class="token punctuation">,</span><span class="token char">'C'</span><span class="token punctuation">)</span> AS 结果

<span class="token class-name">SELECT</span> <span class="token function">CONCAT</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span>first_name<span class="token punctuation">)</span> AS 姓名
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>附加：</strong></p>
<ul>
<li><strong>IFNULL函数</strong></li>
</ul>
<p>MySQL <code>IFNULL</code>函数是MySQL控制流函数之一，它接受两个参数，如果不是<code>NULL</code>，则返回第一个参数。 否则，<code>IFNULL</code>函数返回第二个参数。</p>
<p>两个参数可以是文字值或表达式。</p>
<p>以下说明了<code>IFNULL</code>函数的语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">IFNULL</span><span class="token punctuation">(</span>expression_1<span class="token punctuation">,</span>expression_2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果<code>expression_1</code>不为<code>NULL</code>，则<code>IFNULL</code>函数返回<code>expression_1</code>; 否则返回<code>expression_2</code>的结果。</p>
<p><code>IFNULL</code>函数根据使用的上下文返回字符串或数字。</p>
<p>如果要返回基于<code>TRUE</code>或<code>FALSE</code>条件的值，而不是<code>NULL</code>，则应使用IF函数。</p>
<ul>
<li><strong>ISNULL函数</strong></li>
</ul>
<p>返回 <strong>一个布尔值</strong> ，该值指示一个 表达式 是否不包含 Null (数据) 。</p>
<p><strong>语法</strong></p>
<p>所需的 <strong>表达式参数</strong>包含一个或多个 数值表达式 变量 字符串表达式 。</p>
<p><strong>备注</strong></p>
<p><strong>如果表达式为</strong> <strong>Null，</strong>则 IsNull<strong>返回\True;<strong>否则</strong>，IsNull</strong>返回<strong>False。如果表达式由多个表达式 变量 ，则任何构成变量中的</strong>Null都会导致为整个表达式返回 True。</p>
<p>Null 值表示<strong>变体不包含</strong>任何有效数据。 <strong>Null</strong> 与 空 不同，它表示变量尚未初始化。 它也不与零长度字符串 (“) ，有时称为 null 字符串。</p>
<p><strong>重要:</strong> 使用 <strong>IsNull</strong> 函数确定表达式是否包含 <strong>Null</strong> 值。 在某些情况下，预期计算结果为<strong>True</strong>的表达式（例如 If Var &#x3D; Null 和 If Var &lt;&gt; Null）始终<strong>为 False。</strong> 这是因为包含NULL<strong>的任何表达式本身为</strong>Null，<strong>因此为</strong>False。</p>
<hr>
<h3 id="3-2条件查询"><a href="#3-2条件查询" class="headerlink" title="3.2条件查询"></a>3.2条件查询</h3><p><strong>语法：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM   表名
WHERE 筛选条件<span class="token punctuation">;</span>#类似于<span class="token keyword">if</span>语句
#执行语句顺序 <span class="token number">2</span>、<span class="token number">3</span>、<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>分类：</strong></p>
<p><strong>1.按条件表达式筛选</strong></p>
<ul>
<li>简单条件运算符：&gt;  &lt;  &#x3D;  !&#x3D;或&lt;&gt;(建议这个)  &gt;&#x3D;  &lt;&#x3D;</li>
</ul>
<p>案例一：查询工资&gt;12000的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
WHERE salary<span class="token operator">></span><span class="token number">12000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询部门编号不等于90号的员工名和部门编号</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  department_id 
FROM
  employees 
WHERE department_id <span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span> <span class="token number">90</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.按逻辑表达式筛选</strong></p>
<p>作用：用于连接条件表达式</p>
<ul>
<li>逻辑运算符 &amp;&amp;  ||  ！</li>
</ul>
<p>​       建议使用MySQL里自带的 and  or  not</p>
<p>案例一：查询工资在10000到20000之间的员工名、工资、以及奖金</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  salary<span class="token punctuation">,</span>
  commission_pct 
FROM
  employees 
WHERE salary <span class="token operator">>=</span> <span class="token number">10000</span> 
  AND salary <span class="token operator">&lt;=</span> <span class="token number">20000</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询部门编号不是在90到110之间，或者工资高于15000的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
WHERE department_id <span class="token operator">&lt;=</span> <span class="token number">90</span> 
  OR department_id <span class="token operator">>=</span> <span class="token number">110</span> 
  OR salary <span class="token operator">>=</span> <span class="token number">15000</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3.模糊查询</strong></p>
<p><strong>like</strong></p>
<p>特点：一般和通配符搭配使用</p>
<ul>
<li><p>%任意多个字符，包含0个字符</p>
</li>
<li><p>任意单个字符</p>
</li>
</ul>
<p>案例一：查询员工名中包含字符a的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
WHERE last_name LIKE <span class="token char">'%a%'</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询员工名中第三个字符为e，第五个字符为a的员工名和工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
last_name<span class="token punctuation">,</span>
salary
FROM
employees
WHERE
last_name LIKE <span class="token char">'__e_a%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：查询员工名中第二个字符为_的员工名</p>
<p><strong>ESCAPE转译</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT
last_name
FROM
employees
WHERE
last_name LIKE <span class="token char">'_\_%'</span><span class="token punctuation">;</span>
#或者last_name LIKE <span class="token char">'_$_%'</span> ESCAPE <span class="token char">'$'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>between and</strong></p>
<p>特点：</p>
<ul>
<li>使用between and可以提高语句的简洁度</li>
<li>包含临界值</li>
<li>两个临界值不要调换顺序</li>
</ul>
<p>案例一：查询员工编号在100到120之间的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
WHERE manager_id BETWEEN <span class="token number">100</span> 
  <span class="token class-name">AND</span> <span class="token number">120</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>in</strong></p>
<p>含义：判断某字段的值是否属于in列表中的某一项</p>
<p>特点：</p>
<ul>
<li>使用in提高语句简洁度</li>
<li>in列表的值类型必须一致或兼容</li>
<li>不支持通配符</li>
</ul>
<p>案例一：查询员工的工种编号是 IT_PROG、AD_VP、AD_PRES中的一个员工名和工种编号</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  job_id 
FROM
  employees 
WHERE job_id IN <span class="token punctuation">(</span>'IT_PROG<span class="token char">', '</span>AD_VP<span class="token char">', '</span>AD_PRES'<span class="token punctuation">)</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>is  null</strong></p>
<p>特点：</p>
<ul>
<li>&#x3D;或&lt;&gt;不能用于判断null值</li>
<li>is null或者is not null 可以判断null值</li>
<li>is不能判断数值(不能当&#x3D;来用)</li>
</ul>
<p>案例一：查询没有奖金的员工名和奖金率</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  commission_pct 
FROM
  employees 
WHERE commission_pct <span class="token class-name">IS</span> NULL <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>附加：安全等于&lt;&#x3D;&gt;</strong></p>
<ul>
<li>可以判断null值</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  commission_pct 
FROM
  employees 
WHERE commission_pct <span class="token operator">&lt;=</span><span class="token operator">></span> NULL <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>也可以判断数值</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
WHERE salary <span class="token operator">&lt;=</span><span class="token operator">></span> <span class="token number">12000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>tips：</p>
<ul>
<li>IS NULL：仅仅可以判断NULL值，可读性较高，建议使用</li>
<li>&lt;&#x3D;&gt;：既可以判断NULL值，又可以判断普通的数值，可读性较低</li>
</ul>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
last_name<span class="token punctuation">,</span>
department_id<span class="token punctuation">,</span>
salary<span class="token operator">*</span><span class="token number">12</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token function">IFNULL</span><span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> AS 年薪
<span class="token class-name">FROM</span>
employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-3排序查询"><a href="#3-3排序查询" class="headerlink" title="3.3排序查询"></a>3.3排序查询</h3><p><strong>语法：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM 表
【WHERE 筛选条件】
ORDER BY 排序列表  【ASC<span class="token operator">|</span>DESC】<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>特点：</strong></p>
<p>1.ASC：升序，DESC：降序，如果不写默认是升序</p>
<p>2.ORDER BY字句中可以支持单个字段、多个字段、表达式、函数、别名</p>
<p>3.ORDER BY字句一般是放再查询语句的最后面，limit字句除外</p>
<p>案例一：查询员工信息，要求工资从高到低排序</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
ORDER BY salary DESC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询部门编号&gt;&#x3D;90的员工信息，按入职信息先后进行排序【添加筛选条件】</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
WHERE department_id <span class="token operator">>=</span> <span class="token number">90</span> 
ORDER BY hiredate ASC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：按年薪的高低显示员工的信息和 年薪【按表达式排序】</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span><span class="token punctuation">,</span>
  salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> <span class="token function">IFNULL</span><span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> AS 年薪 
FROM
  employees 
ORDER BY salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> <span class="token function">IFNULL</span><span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> DESC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例四：按年薪的高低显示员工的信息和 年薪【按别名排序】</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span><span class="token punctuation">,</span>
  salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> <span class="token function">IFNULL</span><span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> AS 年薪 
FROM
  employees 
ORDER BY 年薪 DESC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例五：按姓名的长度显示员工的姓名和工资【按函数排序】</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  <span class="token function">LENGTH</span><span class="token punctuation">(</span>last_name<span class="token punctuation">)</span> 字节长度<span class="token punctuation">,</span>
  last_name<span class="token punctuation">,</span>
  salary 
FROM
  employees 
ORDER <span class="token class-name">BY</span> <span class="token function">LENGTH</span><span class="token punctuation">(</span>last_name<span class="token punctuation">)</span> DESC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例6：查询员工信息，要求先按工资升序排序，再按员工编号降序排序【按多个字段排序】</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 
  <span class="token operator">*</span> 
FROM
  employees 
ORDER BY salary ASC<span class="token punctuation">,</span>
  employee_id DESC <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-4常见函数"><a href="#3-4常见函数" class="headerlink" title="3.4常见函数"></a>3.4常见函数</h3><p><strong>概念：</strong></p>
<p>类似于java的方法，将一组逻辑语句封装在方法体中，对外暴露方法名。</p>
<p><strong>好处：</strong></p>
<ul>
<li>隐藏了实现细节</li>
<li>提高代码的重用性</li>
</ul>
<p><strong>调用：</strong></p>
<p>SECLET 函数名(实参列表) 【from表】;</p>
<p><strong>特点：</strong></p>
<ul>
<li>叫什么(函数名)</li>
<li>干什么(函数功能)</li>
</ul>
<p><strong>分类：</strong></p>
<ul>
<li>单行函数</li>
</ul>
<p>如concat、length、ifnull等</p>
<ul>
<li>分组函数</li>
</ul>
<p>做统计使用，又称为统计函数、聚合函数、组函数</p>
<p><strong>单行函数：</strong></p>
<p><strong>1.字符函数</strong></p>
<ul>
<li><p><strong>length</strong></p>
<p>获取参数值的字节个数</p>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">LENGTH</span><span class="token punctuation">(</span><span class="token char">'joho'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SELECT</span> <span class="token function">LENGTH</span><span class="token punctuation">(</span>'数据库<span class="token class-name">MySQL</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>

SHOW VARIABLES LIKE <span class="token char">'%char%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>conact</strong></p>
<p>拼接字符串</p>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CONCAT</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span><span class="token char">'_'</span><span class="token punctuation">,</span>first_name<span class="token punctuation">)</span> 姓名
<span class="token class-name">FROM</span>
employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>upper(大写)、lower(小写)</strong></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">UPPER</span><span class="token punctuation">(</span><span class="token char">'john'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SELECT</span> <span class="token function">LOWER</span><span class="token punctuation">(</span><span class="token char">'john'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SELECT</span> <span class="token function">LOWER</span><span class="token punctuation">(</span><span class="token char">'JOHN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例一：将姓变大写，名变小写，然后拼接</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  <span class="token function">CONCAT</span><span class="token punctuation">(</span>
    <span class="token function">UPPER</span><span class="token punctuation">(</span>last_name<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token char">'_'</span><span class="token punctuation">,</span>
    <span class="token function">LOWER</span><span class="token punctuation">(</span>first_name<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> AS 姓名 
<span class="token class-name">FROM</span>
  employees <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>substr、substring</strong></p>
<p>截取字符串</p>
</li>
</ul>
<blockquote>
<p>注意：索引从1开始</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#截取从指定索引处后面所有的字符
<span class="token class-name">SELECT</span> <span class="token function">SUBSTR</span><span class="token punctuation">(</span>'罗密欧与朱丽叶'<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> out_put<span class="token punctuation">;</span>#朱丽叶
#截取从指定索引处指定字符长度的字符
<span class="token class-name">SELECT</span> <span class="token function">SUBSTR</span><span class="token punctuation">(</span>'罗密欧与朱丽叶'<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">3</span><span class="token punctuation">(</span>截几位<span class="token punctuation">)</span><span class="token punctuation">)</span> out_put<span class="token punctuation">;</span>#罗密欧<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：姓名中首字符大写，其他字符小写，然后用_拼接显示出来</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  <span class="token function">CONCAT</span><span class="token punctuation">(</span>
    <span class="token function">UPPER</span><span class="token punctuation">(</span><span class="token function">SUBSTR</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token char">'_'</span><span class="token punctuation">,</span>
    <span class="token function">LOWER</span><span class="token punctuation">(</span><span class="token function">SUBSTR</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> AS 姓名 
<span class="token class-name">FROM</span>
  employees <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>instr</strong></p>
<p>返回字符串中子字符串第一次出现的位置。如果在<code>str</code>中找不到子字符串，则<code>INSTR()</code>函数返回零(<code>0</code>)。</p>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">INSTR</span><span class="token punctuation">(</span>'罗密欧与朱丽叶<span class="token char">','</span>朱'<span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>trim</strong></li>
</ul>
<p>除掉一个字串中的字头或字尾</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">LENGTH</span><span class="token punctuation">(</span><span class="token function">TRIM</span><span class="token punctuation">(</span>'     张翠山     '<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token class-name">As</span> out_put<span class="token punctuation">;</span>
#张翠山
<span class="token class-name">SELECT</span> TRIM <span class="token punctuation">(</span><span class="token char">'a'</span> FROM 'aaaaaaaa张aaaaaaaaaaaa翠山aaaaaaaaaaaaaaaa8aaaaaaaaaaaaaaaaaaa '<span class="token punctuation">)</span> <span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#张aaaaaaaaaaaa翠山<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>lpad</strong></li>
</ul>
<p>用指定的字符实现左填充指定长度</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">LPAD</span><span class="token punctuation">(</span><span class="token char">'拉姆达'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token char">'*'</span><span class="token punctuation">)</span> 
<span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#out_put
#<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>拉姆达
<span class="token class-name">SELECT</span> <span class="token function">LPAD</span><span class="token punctuation">(</span><span class="token char">'拉姆达'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token char">'*'</span><span class="token punctuation">)</span> 
<span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#out_put
#拉姆  从右边截断<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>rpad</strong></li>
</ul>
<p>用指定的字符实现右填充指定长度</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">RPAD</span><span class="token punctuation">(</span><span class="token char">'拉姆达'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token char">'ab'</span><span class="token punctuation">)</span> 
<span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#out_put
#拉姆达abababa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>replace</strong></li>
</ul>
<p>替换</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">REPLACE</span><span class="token punctuation">(</span>'JAVA与<span class="token class-name">MyAQL</span><span class="token char">','</span><span class="token class-name">MyAQL</span><span class="token char">','</span>JS'<span class="token punctuation">)</span> <span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#JAVA与JS  
<span class="token class-name">SELECT</span> <span class="token function">REPLACE</span><span class="token punctuation">(</span>'<span class="token class-name">MyAQL</span>与JAVA与<span class="token class-name">MyAQL</span><span class="token char">','</span><span class="token class-name">MyAQL</span><span class="token char">','</span>JS'<span class="token punctuation">)</span> <span class="token class-name">AS</span> out_put<span class="token punctuation">;</span>
#JS与JAVA与JS  全部替换<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.数学函数</strong></p>
<ul>
<li><strong>round</strong></li>
</ul>
<p>四舍五入</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">1.65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">2</span>
<span class="token class-name">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token operator">-</span><span class="token number">2</span>
<span class="token class-name">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">1.567</span>，<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">1.57</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>ceil</strong></li>
</ul>
<p>向上取整，返回&gt;&#x3D;该参数的最小整数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CEIL</span><span class="token punctuation">(</span><span class="token number">1.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">2</span>
<span class="token class-name">SELECT</span> <span class="token function">CEIL</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token operator">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><strong>floor</strong></li>
</ul>
<p>向下取整，返回&lt;&#x3D;该参数的最大整数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CEIL</span><span class="token punctuation">(</span><span class="token number">9.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">9</span>
<span class="token class-name">SELECT</span> <span class="token function">CEIL</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token operator">-</span><span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><strong>truncate</strong></li>
</ul>
<p>截断</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">TRUNCATE</span><span class="token punctuation">(</span><span class="token number">1.65</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">1.6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>mod</strong></li>
</ul>
<p>取余</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token number">1</span>
<span class="token class-name">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#<span class="token operator">-</span><span class="token number">1</span>
#被除数为正结果为正，若为负，结果为负
#相当于
SELECT <span class="token number">10</span><span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>MOD(a,b)：a-a&#x2F;b*b;</p>
<p><strong>3.日期函数</strong></p>
<ul>
<li><strong>now</strong></li>
</ul>
<p>返回当前系统日期+时间</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#now
#<span class="token number">2021</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">49</span><span class="token operator">:</span><span class="token number">07</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>curdate</strong></li>
</ul>
<p>返回当前系统日期，不包含时间</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CURDATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>curtime</strong></li>
</ul>
<p>返回当前时间，不包含日期</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">CURTIME</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>可以获取指定的部分，年、月、日、小时、分钟、秒</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">YEAR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 年<span class="token punctuation">;</span>
<span class="token class-name">SELECT</span> <span class="token function">YEAR</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span> 年 <span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>

<span class="token class-name">SELECT</span> <span class="token function">MONTH</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 月<span class="token punctuation">;</span>
#英文
<span class="token class-name">SELECT</span> <span class="token function">MONTHNAME</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 月<span class="token punctuation">;</span> #<span class="token class-name">August</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>str_to_date</strong></li>
</ul>
<p>将日期格式的字符转换成指定格式的日期</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
<span class="token function">STR_TO_DATE</span><span class="token punctuation">(</span>'<span class="token number">13</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">-</span><span class="token number">1999</span><span class="token char">','</span><span class="token operator">%</span>d<span class="token operator">-</span><span class="token operator">%</span>m<span class="token operator">-</span><span class="token operator">%</span>y'<span class="token punctuation">)</span><span class="token punctuation">;</span>
#<span class="token number">1999</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">-</span><span class="token number">13</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>date_format</strong></li>
</ul>
<p>将日期转换成字符</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
<span class="token function">DATE_FORMAT</span><span class="token punctuation">(</span>'<span class="token number">2018</span><span class="token operator">/</span><span class="token number">6</span><span class="token operator">/</span><span class="token number">6</span><span class="token char">','</span><span class="token operator">%</span><span class="token class-name">Y</span>年<span class="token operator">%</span>m月<span class="token operator">%</span>d日'<span class="token punctuation">)</span><span class="token punctuation">;</span>
#<span class="token number">2018</span>年<span class="token number">6</span>月<span class="token number">6</span>日<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<img src="https://tonkyshan.cn/img/202203021321186.png" alt="20210826113850" style="zoom:80%;" />

<p>案例一：查询有奖金的员工名和入职日期(xx月&#x2F;xx日 xx年)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  <span class="token function">DATE_FORMAT</span><span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> '<span class="token operator">%</span>m月<span class="token operator">/</span><span class="token operator">%</span>d日 <span class="token operator">%</span>y年'<span class="token punctuation">)</span> 入职日期 
FROM
  employees 
WHERE commission_pct IS <span class="token class-name">NOT</span> NULL <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>4.其他函数</strong></p>
<ul>
<li><strong>version</strong></li>
</ul>
<p>版本号</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">VERSION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>database</strong></li>
</ul>
<p>查看当前数据库</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>user</strong></li>
</ul>
<p>查询当前用户</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>5.流程控制函数</strong></p>
<ul>
<li><strong>if函数</strong></li>
</ul>
<p>if else的效果</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
<span class="token function">IF</span><span class="token punctuation">(</span><span class="token char">'10>5'</span><span class="token punctuation">,</span><span class="token char">'大'</span><span class="token punctuation">,</span><span class="token char">'小'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#大<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><strong>case函数</strong></li>
</ul>
<p>使用一：类似switch case 的效果</p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CASE 要判断的字段或表达式
WHEN 常量<span class="token number">1</span> THEN 要显示的值<span class="token number">1</span>或语句<span class="token number">1</span><span class="token punctuation">;</span>#值不用加分号
WHEN 常量<span class="token number">2</span> THEN 要显示的值<span class="token number">2</span>或语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ELSE 要显示的值n或语句n<span class="token punctuation">;</span>
END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：查询员工的工资，要求</p>
<p>部门号&#x3D;30，显示的工资为1.1倍</p>
<p>部门号&#x3D;40，显示的工资为1.2倍</p>
<p>部门号&#x3D;50，显示的工资为1.3倍</p>
<p>其他部门，显示的工资为原工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT salary 原始工资<span class="token punctuation">,</span>department_id<span class="token punctuation">,</span>
CASE department_id
WHEN <span class="token number">30</span> THEN salary<span class="token operator">*</span><span class="token number">1.1</span>
WHEN <span class="token number">40</span> THEN salary<span class="token operator">*</span><span class="token number">1.2</span>
WHEN <span class="token number">50</span> THEN salary<span class="token operator">*</span><span class="token number">1.3</span>
ELSE salary
END AS 新工资
<span class="token class-name">FROM</span>
employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用二：类似 多重if</p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CASE 
WHEN 条件一 THEN 要显示的值<span class="token number">1</span>或语句<span class="token number">1</span>
WHEN 条件一 THEN 要显示的值<span class="token number">1</span>或语句<span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ELSE 要显示的值n或语句n
END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：查询员工的工资的情况</p>
<p>如果工资&gt;20000，显示A级别</p>
<p>如果工资&gt;15000，显示B级别</p>
<p>如果工资&gt;10000，显示C级别</p>
<p>否则显示D级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> 
  salary<span class="token punctuation">,</span>
  CASE
    WHEN salary <span class="token operator">></span> <span class="token number">20000</span> 
    THEN <span class="token char">'A'</span> 
    WHEN salary <span class="token operator">></span> <span class="token number">15000</span> 
    THEN <span class="token char">'B'</span> 
    WHEN salary <span class="token operator">></span> <span class="token number">10000</span> 
    THEN <span class="token char">'C'</span> 
    ELSE <span class="token char">'D'</span> 
  END AS 工资级别 
<span class="token class-name">FROM</span>
  employees <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-5分组函数"><a href="#3-5分组函数" class="headerlink" title="3.5分组函数"></a>3.5分组函数</h3><p>功能：用作统计使用，又称为聚合函数、统计函数、组函数</p>
<p>分类：sum求和、avg平均值、max最大值、min最小值、count计算个数</p>
<p>1.简单使用：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#sum
<span class="token class-name">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#avg
<span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#max
<span class="token class-name">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#min
<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#count
<span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#一起查询
<span class="token class-name">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>  和<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>  平均值<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>  最大值<span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>  最小值<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>  个数
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>特点：</p>
<p>2.参数支持哪些类型</p>
<ul>
<li>sum、avg一般用于处理数值型</li>
<li>max、min、count可以处理任何类型</li>
</ul>
<p>3.是否忽略null值</p>
<p>以上分组函数都忽略nll值</p>
<p>3.可以和distinct搭配实现去重的运算</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token class-name">DISTINCT</span> salary<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> 
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>

<span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token class-name">DISTINCT</span> salary<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4.count函数单独介绍</p>
<p>一般用<code>COUNT(*)</code>统计行数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#统计行数
<span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>
#插入一列<span class="token number">1</span>，查看行数
<span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>效率：</p>
<p>MYISAM存储引擎下，<code>COUNT(*)</code>的效率高</p>
<p>INNODB存储引擎下，<code>COUNT(*)</code>和<code>COUNT(*)</code>的效率差不多，比<code>COUNT(字段)</code>要高一些。</p>
<p>6.和分组函数一同查询的字段有限制</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>employee_id
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>AVG()</code>查询完是一个表格，而employee_id是107个但是只能显示出一个。</p>
<blockquote>
<p>tips：和分组函数一同查询的字段要求是group by后的字段</p>
</blockquote>
<p>7.<strong>DATEDIFF函数</strong></p>
<p>计算日期差</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">DATEDIFF</span><span class="token punctuation">(</span>'<span class="token number">2017</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">1</span><span class="token char">','</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">9</span><span class="token operator">-</span><span class="token number">29</span>'<span class="token punctuation">)</span>
#<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-6分组查询"><a href="#3-6分组查询" class="headerlink" title="3.6分组查询"></a>3.6分组查询</h3><p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 分组函数<span class="token punctuation">,</span>列<span class="token punctuation">(</span>要求出现在group by的后面<span class="token punctuation">)</span>
FROM 表
【WHERE 筛选条件】
GROUP BY 分组的列表
【ORDER BY 字句】<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>tips：查询列表比较特殊，要求是分组函数和group by后面出现的字段</p>
</blockquote>
<p>特点：</p>
<p>1.分组查询中的筛选条件分两类</p>
<table>
<thead>
<tr>
<th></th>
<th>数据源</th>
<th>位置</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>分组前筛选</td>
<td>原始表</td>
<td>group by字句的前面</td>
<td>WHERE</td>
</tr>
<tr>
<td>分组后筛选</td>
<td>分组后的结果集</td>
<td>group by字句的后面</td>
<td>HAVING</td>
</tr>
</tbody></table>
<ul>
<li>分组函数分组函数做条件肯定是放在having字句中</li>
<li>能用分组前筛选的尽量用分组前筛选</li>
</ul>
<p>2.group by字句支持单个字段分组，多个字段分组(多个字段之间用逗号隔开没有顺序要求)，表达式或函数(用的较少)</p>
<p>3.也可以添加排序(排序放在整个分组查询的最后)</p>
<p><strong>1.添加分组前筛选</strong></p>
<p>简单的分组查询：</p>
<p>案例一：查询每个工种的最高工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>job_id
FROM
employees
GROUP <span class="token class-name">BY</span> job_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询每个位置上的部门个数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>location_id
FROM
departments
GROUP <span class="token class-name">BY</span> location_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>添加筛选条件：</p>
<p>案例一：查询邮箱中包含a字符的，每个部门的平均工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM
employees
WHERE
email LIKE <span class="token char">'%a%'</span>
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询有奖金的每个领导手下员工的最高工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM
employees
WHERE
email LIKE <span class="token char">'%a%'</span>
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.添加分组后筛选</strong></p>
<p>添加复杂的筛选条件</p>
<p>案例一：查询哪个部门的员工个数&gt;2</p>
<ul>
<li>查询每个部门的员工个数</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM employees
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>根据Ⅰ的结果进行筛选，查询哪个部门的员工数&gt;2</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM employees
GROUP BY department_id
<span class="token class-name">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询每个工种有奖金的员工的最高工资&gt;12000的工种编号和最高工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>job_id
FROM
employees
WHERE
commission_pct IS NOT NULL
GROUP BY job_id
<span class="token class-name">HAVING</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">12000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：查询领导编号&gt;102的，最低工资&gt;5000的领导的编号是哪个，及其最低工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>manager_id
FROM
employees
WHERE
manager_id<span class="token operator">></span><span class="token number">102</span>
GROUP BY 
manager_id
<span class="token class-name">HAVING</span>
<span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">5000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3.按表达式或函数分组</strong></p>
<p>案例一：按员工姓名的长度分组，查询每一组的员工个数，筛选员工个数&gt;5的有哪些</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">LENGTH</span><span class="token punctuation">(</span>last_name<span class="token punctuation">)</span>
FROM
employees
GROUP <span class="token class-name">BY</span> 
<span class="token function">LENGTH</span><span class="token punctuation">(</span>last_name<span class="token punctuation">)</span>
<span class="token class-name">HAVING</span> 
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>4.按多个字段分组</strong></p>
<p>案例一：查询每个部门每个工种的员工的平均工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id<span class="token punctuation">,</span>job_id
FROM
employees
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">,</span>job_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>5.添加排序</strong></p>
<p>案例一：查询每个部门每个工种的员工的平均工资，并且按平均工资的高低显示</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id<span class="token punctuation">,</span>job_id
FROM
employees
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">,</span>job_id
ORDER <span class="token class-name">BY</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> DESC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-7连接查询"><a href="#3-7连接查询" class="headerlink" title="3.7连接查询"></a>3.7连接查询</h3><p>含义：又称多表查询，当查询的字段来自于多个表时，就会用到连接查询</p>
<p>笛卡尔乘积现象：表1 有m行 ，表2 有n行 ，结果&#x3D;m*n行</p>
<ul>
<li>发生原因：没有有效的连接条件</li>
<li>如何避免：添加有效的连接条件</li>
</ul>
<p>分类：</p>
<p>1.按年代分类</p>
<ul>
<li>sql192标准：仅仅支持内连接</li>
<li>sql199标准【推荐】：支持内连接+外连接(左外和右外)+交叉连接</li>
</ul>
<p>2.按功能分类</p>
<ul>
<li>内连接：等值连接、非等值连接、自连接</li>
<li>外连接：左外连接、右外连接、全外连接</li>
<li>交叉连接</li>
</ul>
<img src="https://tonkyshan.cn/img/202203021318147.png" alt="20210830112023" style="zoom:80%;" />

<p><strong>一.sql192标准</strong></p>
<p><strong>1.等值连接</strong></p>
<ul>
<li>多表等值连接的结果为多表的交集部分</li>
<li>n表连接，至少需要n-1个连接条件</li>
<li>多表的顺序没有要求</li>
<li>一般需要为表起别名</li>
<li>可以搭配前面介绍的所有字句使用，比如排序、分组、筛选</li>
</ul>
<p>案例一：查询男女对应的名字</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> NAME<span class="token punctuation">,</span>boyname
<span class="token class-name">FROM</span>
boys<span class="token punctuation">,</span>beauty
WHERE beauty<span class="token punctuation">.</span>boyfriend_id<span class="token operator">=</span>boys<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询员工名和对应的部门名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>department_name
<span class="token class-name">FROM</span>
departments<span class="token punctuation">,</span>employees
WHERE
departments<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>employees<span class="token punctuation">.</span>`department_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为表起别名：</p>
<p>案例一：查询员工名、工种号、工种名</p>
<ul>
<li>提高语句的简洁度</li>
<li>区分多个重名的字段</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>e<span class="token punctuation">.</span>`job_id`<span class="token punctuation">,</span>job_title
FROM employees e<span class="token punctuation">,</span>jobs j
WHERE e<span class="token punctuation">.</span>`job_id`<span class="token operator">=</span>j<span class="token punctuation">.</span>`job_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>tips：如果为表起了别名，则查询的字段就不能使用原来的表名去限定</p>
<p>两个表的顺序是可以调换的</p>
</blockquote>
<p>加筛选：</p>
<p>案例一：查询有奖金的员工名、部门名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>department_name
<span class="token class-name">FROM</span>
departments<span class="token punctuation">,</span>employees
WHERE
departments<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>employees<span class="token punctuation">.</span>`department_id`
AND
commission_pct IS <span class="token class-name">NOT</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询城市名中第二个字符为o的部门名和城市名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
department_name<span class="token punctuation">,</span>city
FROM
departments d<span class="token punctuation">,</span>locations l
WHERE
d<span class="token punctuation">.</span>`location_id`<span class="token operator">=</span>l<span class="token punctuation">.</span>`location_id`
AND
city LIKE <span class="token char">'_o%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>加分组：</p>
<p>案例一：查询每个城市的部门个数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 个数<span class="token punctuation">,</span>city
FROM
departments d<span class="token punctuation">,</span>locations l
WHERE
d<span class="token punctuation">.</span>`location_id`<span class="token operator">=</span>l<span class="token punctuation">.</span>`location_id`
GROUP <span class="token class-name">BY</span> city<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询有奖金的每个部门的部门名和部门的领导编号和该部门的最低工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
department_name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>manager_id<span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
FROM
departments d<span class="token punctuation">,</span>employees e
WHERE 
d<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>e<span class="token punctuation">.</span>`department_id`
AND commission_pct IS NOT NULL
GROUP <span class="token class-name">BY</span> department_name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>manager_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>加排序：</p>
<p>案例一：查询每个工种的工种名和员工的个数，并且按员工个数降序</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> job_title<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 员工个数
FROM employees e<span class="token punctuation">,</span>jobs j
WHERE
e<span class="token punctuation">.</span>`job_id`<span class="token operator">=</span>j<span class="token punctuation">.</span>`job_id`
GROUP BY job_title
ORDER <span class="token class-name">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> DESC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>三表连接：</p>
<p>案例一：查询员工名、部门名和所在的城市</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span>
last_name<span class="token punctuation">,</span>department_name<span class="token punctuation">,</span>city
FROM
employees e<span class="token punctuation">,</span>departments d<span class="token punctuation">,</span>locations l
WHERE
e<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`
AND
d<span class="token punctuation">.</span>`location_id`<span class="token operator">=</span>l<span class="token punctuation">.</span>`location_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.非等值连接</strong></p>
<p>案例一：查询员工的工资和工资级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> salary<span class="token punctuation">,</span>grade_level
FROM employees e<span class="token punctuation">,</span>job_grades j
WHERE salary BETWEEN j<span class="token punctuation">.</span>iowest_sal AND j<span class="token punctuation">.</span>highest_sal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>3.自连接</strong></p>
<p>案例一：查询员工名和上级的名称</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT e<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>m<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>m<span class="token punctuation">.</span>employee_id
FROM employees e<span class="token punctuation">,</span>employees m
WHERE e<span class="token punctuation">.</span>`manager_id`<span class="token operator">=</span>m<span class="token punctuation">.</span>`employee_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>二.sql199标准</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM 表<span class="token number">1</span> 别名 【连接类型】
JOIN 表<span class="token number">2</span> 别名
ON 连接条件
【WHERE 筛选条件】
【GROUP BY 分组】
【HAVING 筛选条件】
【ORDER BY 排序列表】<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>1.内连接</strong></p>
<p>连接类型：inner</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM 表<span class="token number">1</span> 别名
INNER JOIN 表<span class="token number">2</span> 别名
ON 连接条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>分类：</p>
<p><strong>1.等值连接</strong></p>
<p>特点：</p>
<ul>
<li>可以添加排序、分组、筛选</li>
<li>inner可以省略</li>
<li>筛选条件放在where的后面，连接条件放在on后面，提高分离性，便于阅读</li>
<li>inner join 连接和sql192语法中的等值连接效果是一样的，都是查询多表的交集</li>
</ul>
<p>案例一：查询员工名、部门名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>department_name
FROM
employees e
INNER JOIN departments d
ON e<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询名字中包含e的员工名和工种名(加筛选)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>job_title
FROM
employees e
INNER JOIN jobs j
ON e<span class="token punctuation">.</span>`job_id`<span class="token operator">=</span>j<span class="token punctuation">.</span>`job_id`
WHERE e<span class="token punctuation">.</span>`last_name` LIKE <span class="token char">'%e%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：查询部门个数&gt;3的城市名和部门个数(分组+筛选)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 部门个数<span class="token punctuation">,</span>city
FROM
departments d
INNER JOIN locations l
ON d<span class="token punctuation">.</span>`location_id`<span class="token operator">=</span>l<span class="token punctuation">.</span>`location_id`
GROUP BY city
HAVING 部门个数<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例四：查询部门员工个数&gt;3的部门名和员工个数，并按个数降序(排序)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 个数<span class="token punctuation">,</span>department_name
FROM
employees e
INNER JOIN departments d
ON e<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`
GROUP BY department_name
<span class="token class-name">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">3</span>
ORDER <span class="token class-name">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> DESC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例五：查询员工名、部门名、工种名，并按部门名降序(三表连接)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>department_name<span class="token punctuation">,</span>job_title
FROM employees e
INNER JOIN departments d ON e<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`
INNER JOIN jobs j ON e<span class="token punctuation">.</span>`job_id`<span class="token operator">=</span>j<span class="token punctuation">.</span>`job_id`
ORDER BY department_name DESC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.非等值连接</strong></p>
<p>案例一：查询员工的工资级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> salary<span class="token punctuation">,</span>grade_level
FROM employees e
JOIN job_grades j
ON e<span class="token punctuation">.</span>`salary` BETWEEN j<span class="token punctuation">.</span>`iowest_sal` AND j<span class="token punctuation">.</span>`highest_sal`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询每个工资级别的个数&gt;20的个数，并且按工资级别降序</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 个数<span class="token punctuation">,</span>grade_level
FROM employees e
JOIN job_grades j
ON e<span class="token punctuation">.</span>`salary` BETWEEN j<span class="token punctuation">.</span>`iowest_sal` AND j<span class="token punctuation">.</span>`highest_sal`
GROUP BY grade_level
<span class="token class-name">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">20</span>
ORDER BY grade_level DESC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3.自连接</strong></p>
<p>案例一：查询姓名中包含字符k的员工的名字、上级的名字</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>m<span class="token punctuation">.</span>last_name
FROM
employees e
JOIN employees m
ON e<span class="token punctuation">.</span>`manager_id`<span class="token operator">=</span>m<span class="token punctuation">.</span>`employee_id`
WHERE e<span class="token punctuation">.</span>`last_name` LIKE <span class="token char">'%k%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.外连接</strong></p>
<p>应用场景：用于查询一个表中有，另一个表没有的记录</p>
<p><strong>特点：</strong></p>
<p>1.外连接的查询结果为主表中的所有记录</p>
<ul>
<li>如果从表中有和它匹配的，则显示匹配的值</li>
<li>如果从表中没有和它匹配的，则显示null</li>
<li>外连接查询结果&#x3D;内连接查询结果+主表中有而从表中没有的记录</li>
</ul>
<p>2.左外连接，left join左边的是主表</p>
<p>3.右外连接，right join右边的是主表</p>
<p>4.左外和右外交换两个表的顺序，可以实现同样的效果</p>
<p>5.全外连接&#x3D;内连接的结果+表1中有但是表2中没有的+表2中有但是表1中没有的</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM 表<span class="token number">1</span> 别名
LEFT<span class="token operator">|</span>RIGHT<span class="token operator">|</span>FULL【OUTER】 JOIN 表<span class="token number">2</span> 别名 ON 连接条件
WHERE 筛选条件
GROUP BY 分组条件
HAVING 分组后的筛选
ORDER BY 排序列表
LIMIT 字句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<ul>
<li><strong>左外连接</strong></li>
</ul>
<p>连接类型：left 【outer】</p>
<p>案例一：查询没有男朋友的女神名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT b<span class="token punctuation">.</span>name
FROM beauty b
LEFT OUTER JOIN boys bo
ON  b<span class="token punctuation">.</span>`boyfriend_id`<span class="token operator">=</span>bo<span class="token punctuation">.</span>`id`
WHERE bo<span class="token punctuation">.</span>`id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询哪个部门没有员工(左外连接)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT d<span class="token punctuation">.</span>*<span class="token punctuation">,</span>e<span class="token punctuation">.</span>employee_id
FROM departments d
LEFT OUTER JOIN employees e
ON d<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>e<span class="token punctuation">.</span>`department_id`
WHERE e<span class="token punctuation">.</span>`employee_id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>右外连接</strong></li>
</ul>
<p>连接类型：right 【outer】</p>
<p>案例一：查询没有男朋友的女神名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT b<span class="token punctuation">.</span>name
FROM boys bo
RIGHT OUTER JOIN beauty b
ON  b<span class="token punctuation">.</span>`boyfriend_id`<span class="token operator">=</span>bo<span class="token punctuation">.</span>`id`
WHERE bo<span class="token punctuation">.</span>`id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询哪个部门没有员工(右外连接)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT d<span class="token punctuation">.</span>*<span class="token punctuation">,</span>e<span class="token punctuation">.</span>employee_id
FROM employees e
LEFT OUTER JOIN departments d
ON d<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>e<span class="token punctuation">.</span>`department_id`
WHERE e<span class="token punctuation">.</span>`employee_id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>全外连接</strong></li>
</ul>
<p>连接类型：full 【outer】</p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">USE</span> girls<span class="token punctuation">;</span>
SELECT b<span class="token punctuation">.</span>*<span class="token punctuation">,</span>bo<span class="token punctuation">.</span>*
FROM beauty b
FULL OUTER JOIN boys bo
ON b<span class="token punctuation">.</span>`boyfriend_id`<span class="token operator">=</span>bo<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3.交叉连接</strong></p>
<p>连接类型：cross</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT b<span class="token punctuation">.</span>*<span class="token punctuation">,</span>bo<span class="token punctuation">.</span>*
FROM beauty b
CROSS JOIN boys bo<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>总结：</strong></p>
<p>sql192和sql199<strong>PK</strong></p>
<p>功能：sql支持的较多</p>
<p>可读性：sql199实现连接条件和筛选条件分离，可读性较高</p>
<img src="https://tonkyshan.cn/img/202203021318145.png" alt="20210904174554" style="zoom:67%;" />

<img src="https://tonkyshan.cn/img/202203021318153.png" alt="20210904174652" style="zoom:67%;" />

<p>案例一：查询编号&gt;3的女神的男朋友信息，如果有则列出信息，如果没有，则用null填充</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT b<span class="token punctuation">.</span>id<span class="token punctuation">,</span>b<span class="token punctuation">.</span>name<span class="token punctuation">,</span>bo<span class="token punctuation">.</span>*
FROM beauty b
LEFT OUTER JOIN boys bo
ON b<span class="token punctuation">.</span>`boyfriend_id`<span class="token operator">=</span>bo<span class="token punctuation">.</span>`id`
WHERE b<span class="token punctuation">.</span>`id`<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询哪个城市没有部门</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT city
FROM departments d
RIGHT OUTER JOIN locations l
ON d<span class="token punctuation">.</span>`location_id`<span class="token operator">=</span>l<span class="token punctuation">.</span>`location_id`
WHERE d<span class="token punctuation">.</span>`department_id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：查询部门名为SAL或IT的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT e<span class="token punctuation">.</span>*<span class="token punctuation">,</span>d<span class="token punctuation">.</span>department_name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>department_id
FROM departments d
LEFT OUTER JOIN employees e
ON d<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>e<span class="token punctuation">.</span>`department_id`
WHERE d<span class="token punctuation">.</span>`department_name` IN <span class="token punctuation">(</span><span class="token char">'SAL'</span><span class="token punctuation">,</span><span class="token char">'IT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://tonkyshan.cn/img/202203021321533.png" alt="20210904181727"></p>
<p><img src="https://tonkyshan.cn/img/202203021321181.png" alt="20210904181736"></p>
<blockquote>
<p>tips：一个名字但是id不一样</p>
</blockquote>
<hr>
<h3 id="3-8子查询"><a href="#3-8子查询" class="headerlink" title="3.8子查询"></a>3.8子查询</h3><p><strong>含义：</strong></p>
<p>出现在其他语句内部的<code>SELECT</code>语句，称为子查询或内查询。</p>
<p>外部的<code>SELECT</code>语句，称为主查询或外查询。</p>
<p><strong>分类：</strong></p>
<p>1.按子查询出现的位置分类</p>
<ul>
<li><code>SELECT</code>后面</li>
</ul>
<p>仅仅支持标量子查询</p>
<ul>
<li><code>FROM</code>后面</li>
</ul>
<p>支持表子查询</p>
<ul>
<li><code>WHERE</code>或<code>HAVING</code>后面(重点)</li>
</ul>
<p>支持标量子查询(单行)(重点)、列子查询(多行)(重点)、行子查询</p>
<ul>
<li><code>EXISTS</code>后面(相关子查询)</li>
</ul>
<p>支持表子查询</p>
<p>2.按结果集的行列数不同分类</p>
<ul>
<li>标量子查询(结果集只有一行一列)</li>
<li>列子查询(结果集有一列多行)</li>
<li>行子查询(结果集有一行多列)</li>
<li>表子查询(结果集为一般为多行多列)</li>
</ul>
<p><strong>一.<code>WHERE</code>或<code>HAVING</code>后面</strong></p>
<p><strong>特点：</strong></p>
<ul>
<li>子查询放在小括号内</li>
<li>子查询一般放在条件的右侧</li>
<li>标量子查询，一般搭配着单行操作符使用</li>
</ul>
<p><code>&gt;</code> <code>&lt;</code> <code>&gt;=</code> <code>&lt;=</code> <code>=</code> <code>&lt;&gt;</code></p>
<ul>
<li>列子查询，一般搭配着多行操作符使用</li>
</ul>
<p>IN、ANY&#x2F;SOME、ALL</p>
<ul>
<li>子查询的执行优先于主查询执行，主查询的条件用到了子查询的结果</li>
</ul>
<p><strong>1.标量子查询(单行子查询)</strong></p>
<p><em>一列一行</em></p>
<p>案例一：谁的工资比Abel高？</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> 
FROM employees
WHERE salary<span class="token operator">></span><span class="token punctuation">(</span>
	SELECT salary
	FROM employees
	<span class="token class-name">WHERE</span> last_name<span class="token operator">=</span><span class="token char">'Abel'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询<code>job_id</code>与141号员工相同，<code>salary</code>比143号员工多的员工的姓名、<code>job_id</code>和工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
<span class="token class-name">WHERE</span> job_id<span class="token operator">=</span><span class="token punctuation">(</span>
	SELECT job_id
	FROM employees
	<span class="token class-name">WHERE</span>	employee_id<span class="token operator">=</span><span class="token number">141</span>
<span class="token punctuation">)</span>
AND salary<span class="token operator">></span><span class="token punctuation">(</span>
	SELECT salary
	FROM employees
	<span class="token class-name">WHERE</span> employee_id<span class="token operator">=</span><span class="token number">143</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：返回公司工资最少的员工的<code>last_name</code>、<code>job_id</code>、<code>salary</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
<span class="token class-name">WHERE</span>	salary<span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	<span class="token class-name">FROM</span> employees
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例四：查询最低工资大于50号部门最低工资的部门id和其最低工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM employees
GROUP BY department_id
<span class="token class-name">HAVING</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	FROM employees
	<span class="token class-name">WHERE</span> department_id<span class="token operator">=</span><span class="token number">50</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>非法使用标量子查询</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM employees
GROUP BY department_id
<span class="token class-name">HAVING</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>
	SELECT salary
	FROM employees
	<span class="token class-name">WHERE</span> department_id<span class="token operator">=</span><span class="token number">50</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>department_id
FROM employees
GROUP BY department_id
<span class="token class-name">HAVING</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	FROM employees
	<span class="token class-name">WHERE</span> department_id<span class="token operator">=</span><span class="token number">250</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.列子查询(多行子查询)</strong></p>
<p><em>一列多行</em></p>
<ul>
<li>返回多行</li>
<li>使用多行比较操作符</li>
</ul>
<p><img src="https://tonkyshan.cn/img/202203021318642.png" alt="20210906184307"></p>
<p>案例一：返回<code>location_id</code>是1400或1700的部门中的所有员工姓名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT last_name
FROM employees
WHERE department_id <span class="token function">IN</span><span class="token punctuation">(</span>
	SELECT DISTINCT department_id
	FROM departments
	WHERE location_id <span class="token function">IN</span><span class="token punctuation">(</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token number">1700</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT last_name
FROM employees
<span class="token class-name">WHERE</span> department_id <span class="token operator">=</span><span class="token function">ANY</span><span class="token punctuation">(</span>
	SELECT DISTINCT department_id
	FROM departments
	WHERE location_id <span class="token function">IN</span><span class="token punctuation">(</span><span class="token number">1400</span><span class="token punctuation">,</span><span class="token number">1700</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<ul>
<li>IN等价于&#x3D;ALL</li>
<li>NOT IN等价于&lt;&gt;ALL</li>
</ul>
</blockquote>
<p>案例二：返回其它工种中比<code>job_id</code>为<code>IT_PROG</code>工种任一工资低的员工的员工号、姓名、<code>job id</code> 以及<code>salary</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>employee_id<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
WHERE salary<span class="token operator">&lt;</span><span class="token function">ANY</span><span class="token punctuation">(</span>
	SELECT salary
	FROM employees
	<span class="token class-name">WHERE</span> job_id<span class="token operator">=</span>'IT_PROG'
<span class="token punctuation">)</span>
AND job_id<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span>'IT_PROG'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>employee_id<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
WHERE salary<span class="token operator">&lt;</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	FROM employees
	<span class="token class-name">WHERE</span> job_id<span class="token operator">=</span>'IT_PROG'
<span class="token punctuation">)</span>
AND job_id<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span>'IT_PROG'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：返回其它工种中比<code>job_id</code>为<code>IT_PROG</code>工种所有工资低的员工的员工号、姓名、<code>job id</code> 以及<code>salary</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>employee_id<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
WHERE salary<span class="token operator">&lt;</span><span class="token function">ALL</span><span class="token punctuation">(</span>
	SELECT salary
	FROM employees
	<span class="token class-name">WHERE</span> job_id<span class="token operator">=</span>'IT_PROG'
<span class="token punctuation">)</span>
AND job_id<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span>'IT_PROG'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>employee_id<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary
FROM employees
WHERE salary<span class="token operator">&lt;</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	FROM employees
	<span class="token class-name">WHERE</span> job_id<span class="token operator">=</span>'IT_PROG'
<span class="token punctuation">)</span>
AND job_id<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span>'IT_PROG'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3.行子查询(多列多行)</strong></p>
<p><em>一行多列或者多行多列</em>     主要为一行多列</p>
<p>案例一：查询员工编号最小并且工资最高的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
<span class="token class-name">WHERE</span> employee_id<span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span>
	<span class="token class-name">FROM</span> employees
<span class="token punctuation">)</span>
<span class="token class-name">AND</span> salary<span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	<span class="token class-name">FROM</span> employees
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> 
FROM employees
WHERE <span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span>salary<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	<span class="token class-name">FROM</span> employees
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>二.<code>SELECT</code>后面</strong></p>
<ul>
<li><strong>仅仅支持标量子查询</strong></li>
</ul>
<p>案例一：查询每个部门的员工个数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT d<span class="token punctuation">.</span>*<span class="token punctuation">,</span><span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
	FROM employees e
	WHERE d<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>e<span class="token punctuation">.</span>department_id
<span class="token punctuation">)</span> 个数
FROM departments d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询员工号&#x3D;102的部门名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token punctuation">(</span>
	SELECT department_name
	FROM departments d
	INNER JOIN employees e
	ON d<span class="token punctuation">.</span>department_id<span class="token operator">=</span>e<span class="token punctuation">.</span>department_id
	WHERE  e<span class="token punctuation">.</span>employee_id<span class="token operator">=</span><span class="token number">102</span>
<span class="token punctuation">)</span> 部门名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>三.<code>FROM</code>后面</strong></p>
<p><strong>仅仅支持表子查询</strong></p>
<blockquote>
<p>tips：将子查询结果充当一张表，要求必须起别名</p>
</blockquote>
<p>案例一：查询每个部门的平均工资的工资等级</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT ag_dep<span class="token punctuation">.</span>*<span class="token punctuation">,</span>j<span class="token punctuation">.</span>`grade_level`
FROM <span class="token punctuation">(</span>
	<span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> ag<span class="token punctuation">,</span>department_id
	FROM employees
	GROUP <span class="token class-name">BY</span> department_id
<span class="token punctuation">)</span> ag_dep
INNER JOIN job_grades j
ON ag_dep<span class="token punctuation">.</span>ag BETWEEN j<span class="token punctuation">.</span>`iowest_sal` AND j<span class="token punctuation">.</span>`highest_sal`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>四.<code>EXISTS</code>后面(相关子查询)</strong></p>
<p><strong>仅仅支持表子查询</strong></p>
<p>exists 布尔类型</p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">EXISTS</span><span class="token punctuation">(</span>完整的查询语句<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果：1或0</p>
<p>案例一：查询有员工的部门名</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#用EXISTS
SELECT department_name
FROM departments d
<span class="token class-name">WHERE</span> <span class="token function">EXISTS</span><span class="token punctuation">(</span>
	SELECT <span class="token operator">*</span>
	FROM employees e
	WHERE e<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#用IN
SELECT department_name
FROM departments d
WHERE d<span class="token punctuation">.</span>`department_id` <span class="token function">IN</span><span class="token punctuation">(</span>
	SELECT department_id
	<span class="token class-name">FROM</span> employees
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询没有女朋友的男神信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#IN
SELECT bo<span class="token punctuation">.</span>*
FROM boys bo
WHERE bo<span class="token punctuation">.</span>`id` <span class="token class-name">NOT</span> <span class="token function">IN</span><span class="token punctuation">(</span>
	SELECT boyfriend_id
	<span class="token class-name">FROM</span> beauty
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#EXISTS
SELECT bo<span class="token punctuation">.</span>*
FROM boys bo
WHERE <span class="token class-name">NOT</span> <span class="token function">EXISTS</span><span class="token punctuation">(</span>
	SELECT boyfriend_id
	FROM beauty b
	WHERE bo<span class="token punctuation">.</span>`id`<span class="token operator">=</span>b<span class="token punctuation">.</span>`boyfriend_id`
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-9分页查询"><a href="#3-9分页查询" class="headerlink" title="3.9分页查询"></a>3.9分页查询</h3><ul>
<li>应用场景： 当要显示的数据，一页显示不全，需要分页提交sql请求</li>
<li>语法：</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 	查询列表
FROM 表
【JOIN TYPE JOIN 表<span class="token number">2</span>
ON 连接条件
WHERE 筛选条件
GROUP BY 分组字段
HAVING 分组后的筛选
ORDER BY 排序的字段】
<span class="token class-name">LIMIT</span> offset<span class="token punctuation">,</span>size<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>offset</code>：要显示条目的起始索引(起始索引从0开始)</li>
<li><code>size</code>：要显示的条目个数</li>
</ul>
<p>特点：</p>
<ul>
<li><code>LIMIT</code>语句放在查询语句的最后</li>
<li>公式</li>
</ul>
<p>要显示的页数  page     每页的条目数   size</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT 查询列表
FROM 表
LIMIT <span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>size<span class="token punctuation">,</span>size<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例一：查询前五条员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
<span class="token class-name">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询第11条——第25条</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
<span class="token class-name">LIMIT</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例三：有奖金的员工信息，并且工资较高的前10名显示出来</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM employees
WHERE commission_pct IS NOT NULL
ORDER BY salary DESC
<span class="token class-name">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="3-10union联合查询"><a href="#3-10union联合查询" class="headerlink" title="3.10union联合查询"></a>3.10union联合查询</h2><p>关键字：<strong>UNION</strong> 联合 合并 ：将多条查询语句的结果合并成一个结果</p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">查询语句<span class="token number">1</span>
UNION
查询语句<span class="token number">2</span>
UNION
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>应用场景：要查询的结果来自于多个表，且多个表没有直接的连接关系，但查询的信息一致时，一般用联合查询。</p>
<p>特点：</p>
<ul>
<li>要求多条查询语句的查询列数是一致的</li>
<li>要求多条查询语句查询的每一列的类型和顺序最好一致</li>
<li>UNION关键字默认去重，如果使用UNION ALL可以包含重复项</li>
</ul>
<p>案例一：查询部门编号大于90或者邮箱包含a的员工信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span>
FROM
employees
WHERE email LIKE <span class="token char">'%a%'</span>
OR department_id<span class="token operator">></span><span class="token number">90</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> FROM employees WHERE email LIKE <span class="token char">'%a%'</span>
UNION
SELECT <span class="token operator">*</span> FROM employees WHERE department_id<span class="token operator">></span><span class="token number">90</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="第四章-DML语言"><a href="#第四章-DML语言" class="headerlink" title="第四章    DML语言"></a>第四章    DML语言</h2><hr>
<p><strong>数据操纵语言</strong></p>
<h3 id="4-1插入语言"><a href="#4-1插入语言" class="headerlink" title="4.1插入语言"></a>4.1插入语言</h3><p><strong>INSERT</strong></p>
<p><strong>方式一：经典的插入</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT INTO 表名<span class="token punctuation">(</span>列名<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">VALUES</span><span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>1.插入的值的类型要与列的类型一致或兼容</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>borndate<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>photo<span class="token punctuation">,</span>boyfriend_id<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token char">'唐艺昕'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1990</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">23</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>2.不可以为null的列必须插入值，可以为null的列如何插入值？</p>
<p>方式一：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>borndate<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>photo<span class="token punctuation">,</span>boyfriend_id<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token char">'唐艺昕'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1990</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">23</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>方式二：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>borndate<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>boyfriend_id<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token char">'金星'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1980</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">13</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>3.列的顺序是否可以调换</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>id<span class="token punctuation">,</span>phone<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token char">'蒋欣'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>'<span class="token number">18988588888</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可以调换</p>
<p>4.列数和值的个数必须一致</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>id<span class="token punctuation">,</span>phone<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token char">'蒋欣'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>'<span class="token number">18988588888</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.可以省略列名，默认所有列，而且列的顺序和表中列的顺序一致</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT INTO beauty
<span class="token function">VALUES</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token char">'张飞'</span><span class="token punctuation">,</span><span class="token char">'男'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token char">'119'</span><span class="token punctuation">,</span>NULL<span class="token punctuation">,</span>NULL<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>方式二：</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT INTO 表名
SET 列名<span class="token operator">=</span>值<span class="token punctuation">,</span>列名<span class="token operator">=</span>值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>案例一：插入数据</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT INTO beauty
<span class="token class-name">SET</span> id<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span>NAME<span class="token operator">=</span><span class="token char">'刘涛'</span><span class="token punctuation">,</span>phone<span class="token operator">=</span><span class="token char">'999'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>两种方式进行比较</strong></p>
<p>1.方式一：支持插入多行</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>borndate<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>photo<span class="token punctuation">,</span>boyfriend_id<span class="token punctuation">)</span>
<span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token char">'唐艺昕'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1990</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">23</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token char">'唐艺昕'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1990</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">23</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token char">'唐艺昕'</span><span class="token punctuation">,</span><span class="token char">'女'</span><span class="token punctuation">,</span>'<span class="token number">1990</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">23</span><span class="token char">','</span><span class="token number">18988888888</span>'<span class="token punctuation">,</span>NULL<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.方式一：支持子查询</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT <span class="token class-name">INTO</span> <span class="token function">beauty</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>phone<span class="token punctuation">)</span>
<span class="token class-name">SELECT</span> id<span class="token punctuation">,</span>boyname<span class="token punctuation">,</span>'<span class="token number">11809866</span>'
FROM boys 
WHERE id<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="4-2修改语句"><a href="#4-2修改语句" class="headerlink" title="4.2修改语句"></a>4.2修改语句</h3><p><strong>UPDATE</strong></p>
<p><strong>1.修改单表的记录</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE 表名#<span class="token number">1</span>
SET 列<span class="token operator">=</span>新值<span class="token punctuation">,</span>列<span class="token operator">=</span>新值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>#<span class="token number">2</span>
WHERE 筛选条件<span class="token punctuation">;</span>#<span class="token number">3</span>
#执行顺序<span class="token number">132</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：修改beauty表中姓唐的电话为13899889999</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE beauty
<span class="token class-name">SET</span> phone<span class="token operator">=</span>'<span class="token number">13899889999</span>'
WHERE NAME LIKE <span class="token char">'唐%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例二：修改boys表中id号为2的名称为张飞，魅力值1000</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE boys
<span class="token class-name">SET</span> boyName<span class="token operator">=</span><span class="token char">'张飞'</span><span class="token punctuation">,</span>userCP<span class="token operator">=</span><span class="token number">1000</span>
<span class="token class-name">WHERE</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>2.修改多表的记录(级联更新)</strong></p>
<p>语法：</p>
<p>sql192语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE 表<span class="token number">1</span> 别名<span class="token punctuation">,</span>表<span class="token number">2</span> 别名
SET 列<span class="token operator">=</span>值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
WHERE 连接条件
AND 筛选条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>sql199语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE 表<span class="token number">1</span> 别名
INNER<span class="token operator">|</span>LEFT<span class="token operator">|</span>RIGHT JOIN 表<span class="token number">2</span> 别名
ON 连接条件
SET 列<span class="token operator">=</span>值
WHERE 筛选条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：修改张无忌女朋友的手机号为114</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE boys bo
INNER JOIN beauty b
ON bo<span class="token punctuation">.</span>`id`<span class="token operator">=</span>b<span class="token punctuation">.</span>`boyfriend_id`
<span class="token class-name">SET</span> phone<span class="token operator">=</span><span class="token number">114</span>
<span class="token class-name">WHERE</span> boyName<span class="token operator">=</span><span class="token char">'张无忌'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：修改没有男朋友的女神的男朋友编号都为2号</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE boys bo
RIGHT JOIN beauty b
ON bo<span class="token punctuation">.</span>`id`<span class="token operator">=</span>b<span class="token punctuation">.</span>`boyfriend_id`
<span class="token class-name">SET</span> boyfriend_id<span class="token operator">=</span><span class="token number">2</span>
WHERE b<span class="token punctuation">.</span>`boyfriend_id` <span class="token class-name">IS</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="4-3删除语句"><a href="#4-3删除语句" class="headerlink" title="4.3删除语句"></a>4.3删除语句</h3><p><strong>DELETE</strong></p>
<p><strong>1.单表的删除</strong></p>
<p>方式一：<strong>DELETE</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE 
FROM 表名 
【WHERE 筛选条件】
【LIMIT 条目数】 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例：删除一条</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE
FROM beauty
<span class="token class-name">WHERE</span> boyfriend_id<span class="token operator">=</span><span class="token number">4</span>
<span class="token class-name">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：删除手机号以9结尾的女神信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE 
FROM beauty b
WHERE phone LIKE <span class="token char">'%9'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>方式二：<strong>TRUNCATE语句</strong></p>
<ul>
<li>不允许加WHERE语句</li>
<li>删除表中全部数据</li>
</ul>
<p>案例二：将魅力值&gt;100的男神的信息删除</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#不允许筛选，全部删除<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>2.多表的删除(级联删除)</strong></p>
<p>方式一：<strong>DELETE</strong></p>
<p>语法：</p>
<p>sql192语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE 表<span class="token number">1</span>的别名，表<span class="token number">2</span>的别名#删除哪个表写哪个表
FROM 表<span class="token number">1</span> 别名<span class="token punctuation">,</span>表<span class="token number">2</span> 别名
WHERE 连接条件
AND 筛选条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>sql199语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE 表<span class="token number">1</span>的别名，表<span class="token number">2</span>的别名
FROM 表<span class="token number">1</span> 别名
INNER<span class="token operator">|</span>LEFT<span class="token operator">|</span>RIGHT JOIN 表<span class="token number">2</span> 别名 
ON 连接条件
WHERE 筛选条件<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：删除张无忌的女朋友的信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE b
FROM boys bo
JOIN beauty b
ON bo<span class="token punctuation">.</span>`id`<span class="token operator">=</span>b<span class="token punctuation">.</span>`boyfriend_id`
<span class="token class-name">WHERE</span> boyName<span class="token operator">=</span><span class="token char">'张无忌'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：删除黄晓明的信息以及他女朋友的信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DELETE</span> b<span class="token punctuation">,</span>bo
FROM boys bo
RIGHT JOIN beauty b
ON bo<span class="token punctuation">.</span>`id`<span class="token operator">=</span>b<span class="token punctuation">.</span>`boyfriend_id`
<span class="token class-name">WHERE</span> boyName<span class="token operator">=</span><span class="token char">'黄晓明'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>DELETE</strong>和<strong>TRUNCATE</strong> 比较：(<strong>面试题</strong>)</p>
<p>1.delete可以加<code>WHERE</code>条件,<code>TRUNCATE</code>不能加</p>
<p>2.<code>TRUNCATE</code>删除，效率高一点</p>
<p>3.加入要删除表中有自增长列，如果用delete删除后，再插入数据，自增长列从断点开始，而truncate删除后，再插入数据，自增长列的值从1开始</p>
<p>4.truncate删除，没有返回值，delete删除，有返回值</p>
<p>5.truncate删除，不能回滚，delete删除，可以回滚</p>
<hr>
<h2 id="第五章-DDL语言"><a href="#第五章-DDL语言" class="headerlink" title="第五章    DDL语言"></a>第五章    DDL语言</h2><hr>
<p><strong>数据定义语言</strong></p>
<h3 id="5-1库和表的管理"><a href="#5-1库和表的管理" class="headerlink" title="5.1库和表的管理"></a>5.1库和表的管理</h3><hr>
<ul>
<li><strong>创建：<code>CREATE</code></strong></li>
<li><strong>修改：<code>ALTER</code></strong></li>
<li><strong>删除：<code>DROP</code></strong></li>
</ul>
<p><strong>一.库的管理</strong></p>
<p><strong>1.库的创建</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE DATABASE 【IF NOT EXISTS】库名<span class="token punctuation">;</span>#容错性处理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>案例一：创建数据库Books</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE DATABASE IF NOT EXISTS <span class="token class-name">Books</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>2.库的修改</strong>    <del>啥用都没有</del></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">RENAME DATABASE <span class="token class-name">Books</span> TO 新库名<span class="token punctuation">;</span>#已经不能使用了<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>想改的话在文件夹data里面直接改文件夹名称</p>
<p><strong>更改库的字符集</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER DATABASE <span class="token class-name">Books</span> CHARACTER <span class="token class-name">SET</span> gbk<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>3.库的删除</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP DATABASE IF EXISTS <span class="token class-name">Books</span><span class="token punctuation">;</span>#容错性处理<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>二.表的管理</strong></p>
<p><strong>1.表的创建</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE 表名<span class="token punctuation">(</span>
          列名 列的类型 【<span class="token punctuation">(</span>长度<span class="token punctuation">)</span> 约束】<span class="token punctuation">,</span>
          列名 列的类型 【<span class="token punctuation">(</span>长度<span class="token punctuation">)</span> 约束】<span class="token punctuation">,</span>
          列名 列的类型 【<span class="token punctuation">(</span>长度<span class="token punctuation">)</span> 约束】<span class="token punctuation">,</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
          列名 列的类型 【<span class="token punctuation">(</span>长度<span class="token punctuation">)</span> 约束】
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例一：创建表Book</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE <span class="token class-name">Book</span><span class="token punctuation">(</span>
         id INT<span class="token punctuation">,</span>#编号
         bName <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#图书名
         price DOUBLE<span class="token punctuation">,</span>#价格
         authorID <span class="token function">INT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#作者编号
         publishDate DATETIME#出版日期    
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：创建表author</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE IF NOT <span class="token class-name">EXISTS</span> <span class="token function">author</span><span class="token punctuation">(</span>
          id INT<span class="token punctuation">,</span>
          au_name <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          nation <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.表的修改</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE 表名 ADD<span class="token operator">|</span>DROP<span class="token operator">|</span>MODIFY<span class="token operator">|</span>CHANGE COLUMN 列名 【列类型 约束】<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>修改列名</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE book CHANGE COLUMN publishDate pubDate DATETIME<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>tips：<code>COLUMN</code>可以省略</p>
</blockquote>
<ul>
<li>修改列的类型和约束</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE book MODIFY COLUMN pubDate TIMESTAMP<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>添加新列</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE author ADD COLUMN annual DOUBLE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>删除列</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE author DROP <span class="token class-name">COLUMN</span> annual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>修改表名</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE author RENAME <span class="token class-name">TO</span> book_author<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>3.表的删除</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP TABLE IF <span class="token class-name">EXISTS</span> book_author<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>通用的写法</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP DATABASE IF EXISTS 旧库名<span class="token punctuation">;</span>
CREATE DATABASE 新库名<span class="token punctuation">;</span>

DROP TABLE IF EXISTS 旧表名<span class="token punctuation">;</span>
CREATE TABLE 新表名<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>4.表的复制</strong></p>
<p><strong>1.仅复制表的结构</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE author <span class="token class-name">LIKE</span> book_author<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>2.复制表的结构和数据</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE copytwo
SELECT <span class="token operator">*</span> <span class="token class-name">FROM</span> book_author<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>3.只复制部分结构</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE copythree
<span class="token class-name">SELECT</span> id<span class="token punctuation">,</span>au_name
FROM book_author
<span class="token class-name">WHERE</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>#恒不成立<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>4.只复制部分数据</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE copyfour
<span class="token class-name">SELECT</span> id<span class="token punctuation">,</span>au_name
FEOM book_author
<span class="token class-name">WHERE</span> nation<span class="token operator">=</span><span class="token char">'中国'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="5-2常见数据类型介绍"><a href="#5-2常见数据类型介绍" class="headerlink" title="5.2常见数据类型介绍"></a>5.2常见数据类型介绍</h3><p><strong>数值型：</strong></p>
<ul>
<li>整型</li>
</ul>
<p><img src="https://tonkyshan.cn/img/202203021318221.png" alt="20210915215236"></p>
<p>分类：tinyint、smallint、mediumint、int&#x2F;integer、bigint</p>
<p>​             1            2                 3                  4                8   </p>
<p>特点：</p>
<ul>
<li>如果不设置无符号还是有符号，默认是有符号，如果想设置无符号，需要添加unsigned</li>
<li>如果插入的数值超出了整型的范围，会报out of range异常，并且插入失败(新版本)，5的话插入临界值</li>
<li>如果不设置长度，会有默认的长度</li>
</ul>
<p>长度代表了显示的最大宽度，如果不够会用0在左边填充，但必须搭配** <code>ZEROFILL</code>**使用。</p>
<p>1.如何设置无符号和有符号</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE <span class="token class-name">TABLE</span> <span class="token function">tab_int</span><span class="token punctuation">(</span>
	t1 INT<span class="token punctuation">,</span>
	t2 <span class="token class-name">INT</span> UNSIGNED
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DESC</span> tab_int<span class="token punctuation">;</span>

INSERT INTO tab_int <span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123456</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>#无符号范围<span class="token number">0</span><span class="token operator">~</span><span class="token number">4294967295</span>

SELECT <span class="token operator">*</span> <span class="token class-name">FROM</span> tab_int<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>小数</li>
</ul>
<p><img src="https://tonkyshan.cn/img/202203021318228.png" alt="20210916211328"></p>
<p>特点：</p>
<ul>
<li>M：整数部分+小数部分     D：小数部分。如果超出范围，则插入临界值</li>
<li>M和D都可以省略</li>
</ul>
<p>如果是<code>decimal(M,D)</code>，则M默认为10，D默认为0</p>
<p>如果是 <code>float(M,D)</code><strong>和</strong> <code>double(M,D)</code>，则会根据插入的数值的精度来决定精度</p>
<ul>
<li>定点型的精确度较高，如果要求插入数值的精度较高如货币运算等则考虑使用</li>
</ul>
<p>原则：所选择的类型越简单越好，能保存数值的类型越小越好</p>
<p>分类：</p>
<p>1.浮点型</p>
<ul>
<li><code>float(M,D)</code></li>
<li><code>double(M,D)</code></li>
</ul>
<p>2.定点型</p>
<ul>
<li><code>decimal(M,D)</code></li>
</ul>
<p><strong>字符型：</strong></p>
<p>1.较短的文本：</p>
<ul>
<li><code>char(M)</code></li>
<li><code>varchar(M)</code></li>
</ul>
<p><img src="https://tonkyshan.cn/img/202203021321679.png" alt="20210917092411"></p>
<p>特点：</p>
<p>​                        特点                            空间的耗费             效率                     M的意思</p>
<p>char           固定长度的字符               比较耗费                  高             最大的字符数，可以省略，默认为1</p>
<p>varchar      可变长度的字符               比较节省                  低             最大的字符数，不可以省略</p>
<p><strong>位类型</strong></p>
<p><img src="https://tonkyshan.cn/img/202203021318227.png" alt="20210917094843"></p>
<p><strong>binary和varbinary类型</strong></p>
<p>用于保存较短的二进制</p>
<p>说明：类似于char和varchar，不同的是他们包含二进制字符串而不包含非二进制字符串。</p>
<p><strong>Enum类型</strong></p>
<p>用于保存枚举</p>
<p>说明：又称枚举类型，要求插入的值必须属于列表中指定的值之一。</p>
<p><strong>Set类型</strong></p>
<p>用于保存集合</p>
<p>说明：和Enum类型类似，里面可以保存0~64个成员。和Enum类型最大的区别是：Set类型一次可以选取多个成员，而Enum只能选一个，根据成员个数不同，存储所占的字节也不同。</p>
<p><img src="https://tonkyshan.cn/img/202203021318240.png" alt="20210919111952"></p>
<p>2.较长的文本：</p>
<ul>
<li>text</li>
<li>blob(较长的二进制数据)</li>
</ul>
<p><strong>日期型：</strong></p>
<p><img src="https://tonkyshan.cn/img/202203021321758.png" alt="20210919112335"></p>
<p>分类：</p>
<ul>
<li>date只保存日期</li>
<li>time只保存时间</li>
<li>year只保存年</li>
<li>datetime保存日期+时间</li>
<li>timestamp保存日期+时间</li>
</ul>
<p>特点：</p>
<p>​                                             字节                             范围                           时区等的影响</p>
<p>datetime                                 8                             1000-9999                            不受</p>
<p>timestamp                              4                             1970-2038                              受</p>
<hr>
<h3 id="5-3常见约束"><a href="#5-3常见约束" class="headerlink" title="5.3常见约束"></a>5.3常见约束</h3><p><strong>含义：</strong>一种限制，用于限制表中的数据，为了保证表中的数据的准确和可靠性</p>
<p><strong>分类：</strong>六大约束</p>
<ul>
<li><code>NOT NULL</code>：非空约束，用于保证该字段的值不能为空。比如姓名、学号等</li>
<li><code>DEFAULT</code>：默认约束，用于保证该字段有默认值。比如性别</li>
<li><code>PRIMARY KEY</code>：主键约束，用于保证该字段的值具有唯一性，并且非空。比如学号、员工编号等</li>
<li><code>UNIQUE</code>：唯一约束，用于保证该字段的值具有唯一性，可以为空。比如座位号</li>
<li><code>CHECK</code>：检查约束【mysql中不支持】(不报错，但是没有效果)。比如年龄、性别</li>
<li><code>FOREIGN KEY</code>：外键约束，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值。在从表添加外键约束，用于引用主表中某列的值。比如学生表的专业编号，员工表的部门编号，员工表的工种编号</li>
</ul>
<p><strong>添加约束的时机：</strong></p>
<p>1.创建表时</p>
<p>2.修改表时</p>
<p><strong>约束的添加分类</strong></p>
<ul>
<li>列级约束</li>
</ul>
<p>​           六大约束语法上都支持，但外键约束没有效果</p>
<ul>
<li>表级约束</li>
</ul>
<p>​           除了非空、默认，其他的都支持</p>
<p><strong>一、创建表时添加约束</strong></p>
<p>1.添加列级约束</p>
<p>语法：</p>
<p>直接在字段名和类型后面追加 约束类型即可。</p>
<p>只支持：默认、非空、主键、唯一</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE <span class="token class-name">DATABASE</span> students<span class="token punctuation">;</span>

CREATE <span class="token class-name">TABLE</span> <span class="token function">stuinfo</span><span class="token punctuation">(</span>
	id INT <span class="token class-name">PRIMARY</span> KEY<span class="token punctuation">,</span>#主键
	stuName <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token class-name">NOT</span> NULL<span class="token punctuation">,</span>#非空
	gender <span class="token function">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">CHECK</span><span class="token punctuation">(</span>gender<span class="token operator">=</span><span class="token char">'男'</span> <span class="token class-name">OR</span> gender<span class="token operator">=</span><span class="token char">'女'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#检查 不报错，但是没有效果
	seat <span class="token class-name">INT</span> UNIQUE<span class="token punctuation">,</span>#唯一
	age INT <span class="token class-name">DEFAULT</span>  <span class="token number">18</span><span class="token punctuation">,</span>#默认约束
	majorId INT <span class="token class-name">REFERENCES</span> <span class="token function">major</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>#外键  无效果
<span class="token punctuation">)</span><span class="token punctuation">;</span>
CREATE <span class="token class-name">TABLE</span> <span class="token function">major</span><span class="token punctuation">(</span>
        id INT <span class="token class-name">PRIMARY</span> KEY<span class="token punctuation">,</span>
        majorName <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DESC</span> stuinfo<span class="token punctuation">;</span>
#查看stuinfo中的所有索引，包括主键、外键、唯一
SHOW INDEX <span class="token class-name">FROM</span> stuinfo<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.添加表级约束</p>
<p><strong>语法：</strong></p>
<p>在各个字段的最下面</p>
<p>【constraint 约束名】 约束类型(字段名)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP TABLE IF <span class="token class-name">EXISTS</span> stuinfo<span class="token punctuation">;</span>
CREATE <span class="token class-name">TABLE</span> <span class="token function">stuinfo</span><span class="token punctuation">(</span>
	id INT<span class="token punctuation">,</span>
	stuname <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	gender <span class="token function">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	seat INT<span class="token punctuation">,</span>
	age INT<span class="token punctuation">,</span>
	majorid INT<span class="token punctuation">,</span>
	
	CONSTRAINT pk <span class="token class-name">PRIMARY</span> <span class="token function">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>#主键  （默认名为PRIMARY pk没有效果）
	CONSTRAINT uq <span class="token function">UNIQUE</span><span class="token punctuation">(</span>seat<span class="token punctuation">)</span><span class="token punctuation">,</span>#唯一键
	CONSTRAINT ck <span class="token function">CHECK</span><span class="token punctuation">(</span>gender<span class="token operator">=</span><span class="token char">'男'</span> <span class="token class-name">OR</span> gender<span class="token operator">=</span><span class="token char">'女'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>#检查
	CONSTRAINT fk_stuinfo_major <span class="token class-name">FOREIGN</span> <span class="token function">KEY</span><span class="token punctuation">(</span>majorid<span class="token punctuation">)</span> <span class="token class-name">REFERENCES</span> <span class="token function">major</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>#外键
<span class="token punctuation">)</span><span class="token punctuation">;</span>

SHOW INDEX <span class="token class-name">FROM</span> stuinfo<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>通用的写法</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE TABLE IF NOT <span class="token class-name">EXISTS</span> <span class="token function">stuinfo</span><span class="token punctuation">(</span>
	id INT <span class="token class-name">PRIMARY</span> KEY<span class="token punctuation">,</span>
	stuname <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token class-name">NOT</span> NULL<span class="token punctuation">,</span>
	sex <span class="token function">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	age INT <span class="token class-name">DEFAULT</span> <span class="token number">18</span><span class="token punctuation">,</span>
	seat <span class="token class-name">INT</span> UNIQUE<span class="token punctuation">,</span>
	majorid INT<span class="token punctuation">,</span>
	CONSTRAINT fk_stuinfo_major <span class="token class-name">FOREIGN</span> <span class="token function">KEY</span><span class="token punctuation">(</span>majorid<span class="token punctuation">)</span> <span class="token class-name">REFERENCES</span> <span class="token function">major</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>二.修改表时添加约束</strong></p>
<p>1.添加列级约束</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE 表名 MODIFY COLUMN 字段名 字段类型 新约束<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.添加表级约束</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE 表名 ADD 【CONSTRAINT 约束名】 约束类型<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span> 【外键的引用】<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>添加非空约束</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP TABLE IF <span class="token class-name">EXISTS</span> stuinfo<span class="token punctuation">;</span>
CREATE <span class="token class-name">TABLE</span> <span class="token function">stuinfo</span><span class="token punctuation">(</span>
	id INT<span class="token punctuation">,</span>
	stuname <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	gender <span class="token function">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	seat INT<span class="token punctuation">,</span>
	age INT<span class="token punctuation">,</span>
	majorid INT
<span class="token punctuation">)</span><span class="token punctuation">;</span>

#添加非空约束
ALTER TABLE stuinfo MODIFY COLUMN stuname <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token class-name">NOT</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>添加默认约束</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo MODIFY COLUMN age INT <span class="token class-name">DEFAULT</span> <span class="token number">18</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>添加主键</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#列级约束
ALTER TABLE stuinfo MODIFY COLUMN id INT <span class="token class-name">PRIMARY</span> KEY<span class="token punctuation">;</span>
#表级约束
ALTER TABLE stuinfo ADD <span class="token class-name">PRIMARY</span> <span class="token function">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>添加外键</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo ADD CONSTRAINT fk_stuinfo_major <span class="token class-name">FOREIGN</span> <span class="token function">KEY</span><span class="token punctuation">(</span>majorid<span class="token punctuation">)</span> <span class="token class-name">REFERENCES</span> <span class="token function">major</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>二.修改表时删除约束</strong></p>
<ul>
<li>删除非空约束</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#删除非空约束
ALTER TABLE stuinfo MODIFY COLUMN stuname <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>删除默认约束</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo MODIFY COLUMN age INT<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>删除主键</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo DROP <span class="token class-name">PRIMARY</span> KEY<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>删除唯一</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo DROP <span class="token class-name">INDEX</span> seat<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>删除外键</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE stuinfo DROP FOREIGN <span class="token class-name">KEY</span> fk_stuinfo_major<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>三.对比</strong></p>
<p><strong>1.主键和唯一</strong></p>
<p>​                保正唯一性       是否允许为空        一个表中可以有多少个             是否允许组合</p>
<p>主键              √                          ×                            至多有一个                       √，但不推荐</p>
<p>唯一              √                          ×                            可以有多个                       √，但不推荐</p>
<p>组合主键，组合唯一键</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PRIMARY</span> <span class="token function">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>stuname<span class="token punctuation">)</span>#当id与stuname都相同时，会报错<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>2.外键的特点</strong></p>
<ul>
<li>要求在从表设置外键关系</li>
<li>从表的外键列的类型和主表的关联列的类型要求一致或兼容</li>
<li>主表的关联列必须是一个Key(一般是主键或唯一)</li>
<li>插入数据时，先插入主表，再插入从表。删除数据时，先删除从表，再删除主表</li>
</ul>
<p><strong>3.列级约束和表级约束</strong></p>
<p>​                              位置                          支持的约束类型                                 是否可以起约束名</p>
<p>列级约束：       列的后面                 语法都支持，但是外键没有效果                   不可以</p>
<p>表级约束：       所有列的下面          默认和非空不支持，其他支持                       可以(主键没有效果)</p>
<p><strong>标识列</strong></p>
<p>又称为自增长列</p>
<p><strong>含义：</strong>可以不用手动的插入值，系统提供默认的序列值</p>
<p><strong>特点：</strong></p>
<ul>
<li>标识列必须和主键搭配吗？不一定，但要求是一个Key</li>
<li>一个表可以有几个标识列？至多一个！</li>
<li>标识列的类型 只能是数值型</li>
<li>标识列可以通过SET auto_increment_increment&#x3D;3;设置步长，可以通过 手动插入值，设置起始值</li>
</ul>
<p><strong>一.创建表时设置标识列</strong></p>
<p>关键字：** <code>AUTO_INCREMENT</code>**</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP TABLE IF <span class="token class-name">EXISTS</span> tab_indentity<span class="token punctuation">;</span>
CREATE <span class="token class-name">TABLE</span> <span class="token function">tab_indentity</span><span class="token punctuation">(</span>
	id INT PRIMARY <span class="token class-name">KEY</span> AUTO_INCREMENT<span class="token punctuation">,</span>#标识列
	<span class="token class-name">NAME</span> <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

INSERT INTO tab_indentity <span class="token function">VALUE</span><span class="token punctuation">(</span>NULL<span class="token punctuation">,</span><span class="token char">'join'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SELECT <span class="token operator">*</span>
<span class="token class-name">FROM</span> tab_indentity<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>1.MySQL中起始值永远是1，设置其他值也没有效果，但是步程可以设置</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SHOW VARIABLES LIKE '<span class="token operator">%</span>AUTO_INCREMENT<span class="token operator">%</span>'<span class="token punctuation">;</span>
<span class="token class-name">SET</span> auto_increment_increment<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://tonkyshan.cn/img/202203021318866.png" alt="20210926165712"></p>
<p><strong>2.设置起始值</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP TABLE IF <span class="token class-name">EXISTS</span> tab_indentity<span class="token punctuation">;</span>
CREATE <span class="token class-name">TABLE</span> <span class="token function">tab_indentity</span><span class="token punctuation">(</span>
	id INT PRIMARY <span class="token class-name">KEY</span> AUTO_INCREMENT<span class="token punctuation">,</span>#标识列
	<span class="token class-name">NAME</span> <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
INSERT INTO tab_indentity <span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token char">'join'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
INSERT INTO tab_indentity <span class="token function">VALUE</span><span class="token punctuation">(</span>NULL<span class="token punctuation">,</span><span class="token char">'join'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SELECT <span class="token operator">*</span>
<span class="token class-name">FROM</span> tab_indentity<span class="token punctuation">;</span>#起始值就为<span class="token number">10</span>了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>二.修改表时设置标识列</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE tab_indentity MODIFY COLUMN id INT PRIMARY <span class="token class-name">KEY</span> AUTO_INCREMENT<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>三.修改表时删除标识列</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER TABLE tab_indentity MODIFY COLUMN id INT<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="第六章-DCL语言"><a href="#第六章-DCL语言" class="headerlink" title="第六章    DCL语言"></a>第六章    DCL语言</h2><hr>
<p><strong>数据控制语言</strong></p>
<h3 id="6-1管理用户"><a href="#6-1管理用户" class="headerlink" title="6.1管理用户"></a>6.1管理用户</h3><hr>
<p><strong>一.添加用户</strong></p>
<ul>
<li>语法：</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE USER <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span> IDENTIFIED BY <span class="token char">'密码'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>二.删除用户</strong></p>
<ul>
<li>语法：</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP USER <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>三.修改用户密码</strong></p>
<ul>
<li>语法：</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE USER <span class="token class-name">SET</span> PASSWORD <span class="token operator">=</span> <span class="token function">PASSWORD</span><span class="token punctuation">(</span><span class="token char">'新密码'</span><span class="token punctuation">)</span>
<span class="token class-name">WHERE</span> USER <span class="token operator">=</span> <span class="token char">'用户名'</span><span class="token punctuation">;</span>

SET PASSWORD FOR <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span> <span class="token operator">=</span> <span class="token function">PASSWORD</span><span class="token punctuation">(</span><span class="token char">'新密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>MySQL中忘记了root用户的密码？</li>
</ul>
<p>1.cmd - - &gt; net stop mysql     停止mysql服务（需要以管理员身份运行cmd）</p>
<p>2.使用无验证方式启动mysql服务：mysqld –skip-grant-tables</p>
<p>3.打开新的cmd窗口，直接输入mysql命令，敲回车就可以登录成功</p>
<p>4.use mysql</p>
<p>5.update user set password &#x3D; password(‘新密码’) where user&#x3D;’root’;</p>
<p>6.关闭两个窗口</p>
<p>7.打开任务管理器，手动结束mysql.exe进程</p>
<p>8.启动mysql服务</p>
<p>9.使用新密码登录</p>
<p><strong>四.查询用户</strong></p>
<ul>
<li>切换到mysql数据库</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">USE</span> mysql<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>查询user表</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> <span class="token class-name">FROM</span> USER<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>通配符：%表示可以在任意主机使用用户登录数据库</li>
</ul>
<hr>
<h3 id="6-2权限管理"><a href="#6-2权限管理" class="headerlink" title="6.2权限管理"></a>6.2权限管理</h3><p><strong>一.查询权限</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SHOW GRANTS FOR <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>二.授予权限</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">GRANT 权限列表 ON 数据库名<span class="token punctuation">.</span>表名 TO <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span><span class="token punctuation">;</span>

GRANT ALL ON <span class="token operator">*</span><span class="token punctuation">.</span>* TO <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span><span class="token punctuation">;</span>#授予所有的权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>三.撤销权限</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">REVOKE 权限列表 ON 数据库<span class="token punctuation">.</span>表名 FROM <span class="token char">'用户名'</span>@<span class="token char">'主机名'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="第七章-TCL语言"><a href="#第七章-TCL语言" class="headerlink" title="第七章    TCL语言"></a>第七章    TCL语言</h2><hr>
<p><strong>事务控制语言(Transaction Control Language)</strong></p>
<h3 id="7-1事务和事务处理"><a href="#7-1事务和事务处理" class="headerlink" title="7.1事务和事务处理"></a>7.1事务和事务处理</h3><p><strong>事务：</strong>一个或一组sql语句组成的一个执行单元，这个执行单元要么全部执行，要么全部不执行。</p>
<p><strong>MySQL中的存储引擎</strong></p>
<p>1.概念：在MySQL中的数据用各种不同的技术存储在文件(或内存)中。</p>
<p>2.通过show engines，来查看MySQL支持的存储引擎。</p>
<p>3.在MySQL中用的最多存储引擎有：innodb、myisam、memory等。其中innodb支持事务，而myisam、memory等不支持事务。</p>
<p><strong>一.事务的ACID属性</strong></p>
<p><strong>1.原子性</strong>(Atomicity)</p>
<p>原子性是指事务是一个不可分隔的工作单位，事务中的操作要么都发生，要么都不发生。</p>
<p><strong>2.一致性</strong>(Consistency)</p>
<p>事务必须使数据库从一个一致性状态变换到另一个一致性状态。</p>
<p><strong>3.隔离性</strong>(Isolation)</p>
<p>事务的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能相互干扰。</p>
<p><strong>4.持久性</strong>(Durability)</p>
<p>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响。</p>
<p><strong>二.事务的创建</strong></p>
<ul>
<li><strong>隐式事务：</strong>事务没有明显的开启和结束的标记。比如：INSERT、UPDATE、DELETE语句。</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE FROM 表 <span class="token class-name">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><strong>显式事务：</strong>事务具有明显的开启和结束的标记。前提：必须先设置自动提交功能为禁用。</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>#设置自动提交功能为禁用<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>步骤一：开启事务</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> transaction<span class="token punctuation">;</span>#可选的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>步骤二：编写事务中的sql语句(SELECT  INSERT  UPDATE  DELETE)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">语句<span class="token number">1</span><span class="token punctuation">;</span>
语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>步骤三：结束事务</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">COMMIT<span class="token punctuation">;</span>提交事务
ROLLBACK<span class="token punctuation">;</span>回滚事务
SAVEPOINT<span class="token punctuation">;</span>节点名<span class="token punctuation">,</span>设置保存点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>演示事务的使用步骤</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#开启事务
<span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> TRANSACTION<span class="token punctuation">;</span>
#编写一组事务语句
UPDATE account <span class="token class-name">SET</span> balance <span class="token operator">=</span> <span class="token number">1500</span> <span class="token class-name">WHERE</span> username<span class="token operator">=</span><span class="token char">'张无忌'</span><span class="token punctuation">;</span>
UPDATE account <span class="token class-name">SET</span> balance <span class="token operator">=</span> <span class="token number">500</span>  <span class="token class-name">WHERE</span> username<span class="token operator">=</span><span class="token char">'赵敏'</span><span class="token punctuation">;</span>
#结束事务
COMMIT<span class="token punctuation">;</span>#提交<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java">#开启事务
<span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> TRANSACTION<span class="token punctuation">;</span>
#编写一组事务语句
UPDATE account <span class="token class-name">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span> <span class="token class-name">WHERE</span> username<span class="token operator">=</span><span class="token char">'张无忌'</span><span class="token punctuation">;</span>
UPDATE account <span class="token class-name">SET</span> balance <span class="token operator">=</span> <span class="token number">1000</span>  <span class="token class-name">WHERE</span> username<span class="token operator">=</span><span class="token char">'赵敏'</span><span class="token punctuation">;</span>
#结束事务
ROLLBACK<span class="token punctuation">;</span>#回滚

#执行成功后，结果查看为 张无忌<span class="token number">1500</span> 赵敏<span class="token number">500</span> 不变<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>事务的并发问题</strong></p>
<p><img src="https://tonkyshan.cn/img/202203021319927.png" alt="20210928194246"></p>
<p><img src="https://tonkyshan.cn/img/202203021321504.png" alt="20210928194400"></p>
<p><strong>演示事务的隔离级别</strong></p>
<p>​                                                        脏读                    不可重复读                  幻读</p>
<ul>
<li>READ UNCOMMITTED             √                              √                              √ </li>
<li>READ COMMITTED                  ×                              √                              √</li>
<li>REPEATABLE READ                 ×                              ×                              √</li>
<li>SERIALIZABLE                          ×                              ×                              ×</li>
</ul>
<p>MySQL中默认 第三个隔离级别 REPEATABLE READ</p>
<p>Oracle中默认 第二个隔离级别 READ COMMITTED </p>
<p>查看隔离级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT @<span class="token annotation punctuation">@transaction_isolation</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置当前MySQL连接的隔离级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SET TRANSACTION ISOLATION LEVEL <span class="token class-name">READ</span> COMMITTED<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置数据库系统的全局的隔离级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SET GLOBAL TRANSACTION ISOLATION LEVEL <span class="token class-name">READ</span> COMMITTED<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>演示savepoint的使用</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> TRANSACTION<span class="token punctuation">;</span>
DELETE FROM account <span class="token class-name">WHERE</span> id<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span>
<span class="token class-name">SAVEPOINT</span> a<span class="token punctuation">;</span>#设置保存点
DELETE FROM account <span class="token class-name">WHERE</span> id<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">;</span>
ROLLBACK <span class="token class-name">TO</span> a<span class="token punctuation">;</span>#回滚到保存点<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="第八章-视图的讲解"><a href="#第八章-视图的讲解" class="headerlink" title="第八章    视图的讲解"></a>第八章    视图的讲解</h2><hr>
<p><strong>含义：</strong>虚拟表，和普通表一样使用</p>
<p>MySQL5.1版本出现的新特性，是通过表动态生成的数据</p>
<p><strong>应用场景</strong></p>
<ul>
<li>多个地方用到同样的查询结果</li>
<li>该查询结果使用的sql语句较复杂</li>
</ul>
<p><strong>视图的好处</strong></p>
<ul>
<li>重用sql语句</li>
<li>简化复杂的sql操作，不必知道它的查询细节</li>
<li>保护数据，提高安全性</li>
</ul>
<p>案例一：查询姓张的学生名和专业名</p>
<p>以前：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SELECT</span> stuname<span class="token punctuation">,</span>majorname
FROM stuinfo s
INNER JOIN major m
ON s<span class="token punctuation">.</span>`majorid`<span class="token operator">=</span>m<span class="token punctuation">.</span>`id`
WHERE s<span class="token punctuation">.</span>`stuname` LIKE <span class="token char">'张%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过视图：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE VIEW v1
AS
<span class="token class-name">SELECT</span> stuname<span class="token punctuation">,</span>majorname
FROM stuinfo s
INNER JOIN major m
ON s<span class="token punctuation">.</span>`majorid`<span class="token operator">=</span>m<span class="token punctuation">.</span>`id`<span class="token punctuation">;</span>#通过视图进行封装

SELECT <span class="token operator">*</span> FROM v1 WHERE stuname LIKE <span class="token char">'张%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>一.创建视图</strong></p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE VIEW 视图名
AS
查询语句<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>案例一：查询姓名中包含a字符的员工名、部门名和工种信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">USE</span> myemployees<span class="token punctuation">;</span>
#创建
CREATE VIEW myv1
AS 
<span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>department_name<span class="token punctuation">,</span>job_title 
FROM employees e
JOIN departments d
ON e<span class="token punctuation">.</span>department_id<span class="token operator">=</span>d<span class="token punctuation">.</span>department_id
JOIN jobs j
ON j<span class="token punctuation">.</span>job_id <span class="token operator">=</span> e<span class="token punctuation">.</span>job_id<span class="token punctuation">;</span>
#使用
SELECT <span class="token operator">*</span>
FROM myv1
WHERE last_name LIKE <span class="token char">'%a%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例二：查询各部门的平均工资级别</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#创建
CREATE VIEW myv2
AS
<span class="token class-name">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> ag<span class="token punctuation">,</span>department_id
FROM employees
GROUP <span class="token class-name">BY</span> department_id<span class="token punctuation">;</span>
#使用
SELECT myv2<span class="token punctuation">.</span>`ag`<span class="token punctuation">,</span>g<span class="token punctuation">.</span>grade_level
FROM myv2
JOIN job_grades g
ON myv2<span class="token punctuation">.</span>`ag` BETWEEN g<span class="token punctuation">.</span>`iowest_sal` AND g<span class="token punctuation">.</span>`highest_sal`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例三：查询平均工资最低的部门的信息</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">SELECT <span class="token operator">*</span> FROM myv2 ORDER BY ag <span class="token class-name">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>案例四：查询平均工资最低的部门名和工资</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE VIEW myv3
AS
SELECT <span class="token operator">*</span>
FROM myv2 ORDER BY ag <span class="token class-name">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>

SELECT d<span class="token punctuation">.</span>*<span class="token punctuation">,</span>m<span class="token punctuation">.</span>ag
FROM myv3 m
JOIN departments d
ON m<span class="token punctuation">.</span>`department_id`<span class="token operator">=</span>d<span class="token punctuation">.</span>`department_id`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>二.视图的修改</strong></p>
<p>方式一：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE OR REPLACE VIEW 
AS
查询语句<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>方式二：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ALTER VIEW 视图名
AS
查询语句<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>三.删除视图</strong></p>
<p>语法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DROP VIEW 视图名<span class="token punctuation">,</span>视图名<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>四.查看视图</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DESC</span> myv3<span class="token punctuation">;</span>

SHOW CREATE <span class="token class-name">VIEW</span> myv3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>五.视图的更新</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">CREATE OR REPLACE VIEW myv1
AS
<span class="token class-name">SELECT</span> last_name<span class="token punctuation">,</span>email
<span class="token class-name">FROM</span> employees<span class="token punctuation">;</span>

SELECT <span class="token operator">*</span> <span class="token class-name">FROM</span> myv1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>tips：对视图进行更新时，原始表也会进行更新</p>
</blockquote>
<p>1.插入</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">INSERT INTO <span class="token class-name">MYV1</span> <span class="token function">VALUE</span><span class="token punctuation">(</span><span class="token char">'张飞'</span><span class="token punctuation">,</span>'zf<span class="token annotation punctuation">@qq.com</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.修改</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">UPDATE myv1 <span class="token class-name">SET</span> last_name<span class="token operator">=</span><span class="token char">'张无忌'</span> <span class="token class-name">WHERE</span> last_name<span class="token operator">=</span><span class="token char">'张飞'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.删除</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">DELETE FROM myv1 <span class="token class-name">WHERE</span> last_name<span class="token operator">=</span><span class="token char">'张无忌'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4.具备以下特点的视图不能更新</p>
<ul>
<li>包含以下关键字的sql语句:分组函数、distinct、group by、having、union或者union all</li>
<li>常量视图</li>
<li>Select中也含子查询</li>
<li>join</li>
<li>from—个不能更新的视图</li>
<li>where子句的子查询引用了from子句中的表</li>
</ul>
<p><strong>六.视图与表的对比</strong></p>
<p>​                                      创建语法的关键字                          是否实际占用物理空间                          使用</p>
<p>视图                                  create view                                  只是保存了sql逻辑                 增删改查，一般不能增删改</p>
<p>表                                      create table                                       保存了数据                                   增删改查</p>
<p><strong>七.delete和truncate在事务使用时的区别</strong></p>
<p>1.演示delete</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> TRANSACTION<span class="token punctuation">;</span>
DELETE <span class="token class-name">FROM</span> account<span class="token punctuation">;</span>
ROLLBACK<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.演示truncate</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">START</span> TRANSACTION<span class="token punctuation">;</span>
TRUNCATE <span class="token class-name">TABLE</span> account<span class="token punctuation">;</span>
ROLLBACK<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>delete支持回滚，truncate不支持回滚</p>
</blockquote>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>ShanTianQi</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://tonkyshan.cn/2022/01/27/MySQL%E5%9F%BA%E7%A1%80/">https://tonkyshan.cn/2022/01/27/MySQL%E5%9F%BA%E7%A1%80/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="../../../../tags/MySQL/"># MySQL</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="../../29/JDBC/">JDBC</a>
            
            
            <a class="next" rel="next" href="../../25/XML%E5%9F%BA%E7%A1%80/">XML基础</a>
            
        </section>


    </article>
</div>

            </div>
            <!-- <!--<footer id="footer" class="footer">
    <div class="copyright">
        <span>© ShanTianQi | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
 -->
    </div>
</body>

</html>